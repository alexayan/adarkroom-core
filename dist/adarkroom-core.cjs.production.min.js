"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var t=require("@reduxjs/toolkit"),n=e(require("lodash"));require("redux-logger");var a=e(require("node-polyglot"));function r(e,t,n,a,r,o,i){try{var s=e[o](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(a,r)}function o(e){return function(){var t=this,n=arguments;return new Promise((function(a,o){var i=e.apply(t,n);function s(e){r(i,a,o,s,c,"next",e)}function c(e){r(i,a,o,s,c,"throw",e)}s(void 0)}))}}function i(){return(i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function s(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,(Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var l,u,d,h,m,p=(function(e){var t=function(e){var t=Object.prototype,n=t.hasOwnProperty,a="function"==typeof Symbol?Symbol:{},r=a.iterator||"@@iterator",o=a.asyncIterator||"@@asyncIterator",i=a.toStringTag||"@@toStringTag";function s(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(e){s=function(e,t,n){return e[t]=n}}function c(e,t,n,a){var r=Object.create((t&&t.prototype instanceof d?t:d).prototype),o=new E(a||[]);return r._invoke=function(e,t,n){var a="suspendedStart";return function(r,o){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===r)throw o;return{value:void 0,done:!0}}for(n.method=r,n.arg=o;;){var i=n.delegate;if(i){var s=y(i,n);if(s){if(s===u)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===a)throw a="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);a="executing";var c=l(e,t,n);if("normal"===c.type){if(a=n.done?"completed":"suspendedYield",c.arg===u)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(a="completed",n.method="throw",n.arg=c.arg)}}}(e,n,o),r}function l(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var u={};function d(){}function h(){}function m(){}var p={};s(p,r,(function(){return this}));var g=Object.getPrototypeOf,f=g&&g(g(k([])));f&&f!==t&&n.call(f,r)&&(p=f);var v=m.prototype=d.prototype=Object.create(p);function x(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function b(e,t){var a;this._invoke=function(r,o){function i(){return new t((function(a,i){!function a(r,o,i,s){var c=l(e[r],e,o);if("throw"!==c.type){var u=c.arg,d=u.value;return d&&"object"==typeof d&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){a("next",e,i,s)}),(function(e){a("throw",e,i,s)})):t.resolve(d).then((function(e){u.value=e,i(u)}),(function(e){return a("throw",e,i,s)}))}s(c.arg)}(r,o,a,i)}))}return a=a?a.then(i,i):i()}}function y(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,y(e,t),"throw"===t.method))return u;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var a=l(n,e.iterator,t.arg);if("throw"===a.type)return t.method="throw",t.arg=a.arg,t.delegate=null,u;var r=a.arg;return r?r.done?(t[e.resultName]=r.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):r:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function w(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function E(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function k(e){if(e){var t=e[r];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var a=-1,o=function t(){for(;++a<e.length;)if(n.call(e,a))return t.value=e[a],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:O}}function O(){return{value:void 0,done:!0}}return h.prototype=m,s(v,"constructor",m),s(m,"constructor",h),h.displayName=s(m,i,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,s(e,i,"GeneratorFunction")),e.prototype=Object.create(v),e},e.awrap=function(e){return{__await:e}},x(b.prototype),s(b.prototype,o,(function(){return this})),e.AsyncIterator=b,e.async=function(t,n,a,r,o){void 0===o&&(o=Promise);var i=new b(c(t,n,a,r),o);return e.isGeneratorFunction(n)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},x(v),s(v,i,"Generator"),s(v,r,(function(){return this})),s(v,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var a=t.pop();if(a in e)return n.value=a,n.done=!1,n}return n.done=!0,n}},e.values=k,E.prototype={constructor:E,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(w),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function a(n,a){return i.type="throw",i.arg=e,t.next=n,a&&(t.method="next",t.arg=void 0),!!a}for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r],i=o.completion;if("root"===o.tryLoc)return a("end");if(o.tryLoc<=this.prev){var s=n.call(o,"catchLoc"),c=n.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return a(o.catchLoc,!0);if(this.prev<o.finallyLoc)return a(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return a(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return a(o.finallyLoc)}}}},abrupt:function(e,t){for(var a=this.tryEntries.length-1;a>=0;--a){var r=this.tryEntries[a];if(r.tryLoc<=this.prev&&n.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=e,i.arg=t,o?(this.method="next",this.next=o.finallyLoc,u):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),w(n),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var a=n.completion;if("throw"===a.type){var r=a.arg;w(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:k(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),u}},e}(e.exports);try{regeneratorRuntime=t}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}}(m={exports:{}}),m.exports);function g(e){return e}(u=exports.StoreCategory||(exports.StoreCategory={})).wood="wood",u.fur="fur",u.meat="meat",u.iron="iron",u.coal="coal",u.sulphur="sulphur",u.steel="steel",u.cured_meat="cured_meat",u.scales="scales",u.teeth="teeth",u.leather="leather",u.bait="bait",u.torch="torch",u.cloth="cloth",u.bone_spear="bone_spear",u.iron_sword="iron_sword",u.steel_sword="steel_sword",u.bayonet="bayonet",u.rifle="rifle",u.laser_rifle="laser_rifle",u.bullets="bullets",u.energy_cell="energy_cell",u.grenade="grenade",u.bolas="bolas",u.medicine="medicine",u.compass="compass",u.charm="charm",u.alien_alloy="alien_alloy",u.waterskin="waterskin",u.cask="cask",u.water_tank="water_tank",u.rucksack="rucksack",u.wagon="wagon",u.convoy="convoy",u.l_armou="l_armou",u.i_armour="i_armour",u.s_armour="s_armour",u.trap="trap",u.cart="cart",u.hut="hut",u.lodge="lodge",u.trading_post="trading_post",u.tannery="tannery",u.smokehouse="smokehouse",u.workshop="workshop",u.steelworks="steelworks",u.armoury="armoury",(d=exports.GameSpace||(exports.GameSpace={})).Room="Room",d.Path="Path",d.Outside="Outside",d.World="World",d.Ship="Ship",d.Space="Space",(h=exports.PerkCategory||(exports.PerkCategory={})).boxer="boxer",h.martial_artist="martial_artist",h.unarmed_master="unarmed_master",h.barbarian="barbarian",h.slow_metabolism="slow_metabolism",h.desert_rat="desert_rat",h.evasive="evasive",h.precise="precise",h.scout="scout",h.stealthy="stealthy",h.gastronome="gastronome";var f,v,x,b,y=((l={})[exports.PerkCategory.boxer]={name:g("boxer"),desc:g("punches do more damage"),notify:g("learned to throw punches with purpose")},l[exports.PerkCategory.martial_artist]={name:g("martial artist"),desc:g("punches do even more damage."),notify:g("learned to fight quite effectively without weapons")},l[exports.PerkCategory.unarmed_master]={name:g("unarmed master"),desc:g("punch twice as fast, and with even more force"),notify:g("learned to strike faster without weapons")},l[exports.PerkCategory.barbarian]={name:g("barbarian"),desc:g("melee weapons deal more damage"),notify:g("learned to swing weapons with force")},l[exports.PerkCategory.slow_metabolism]={name:g("slow metabolism"),desc:g("go twice as far without eating"),notify:g("learned how to ignore the hunger")},l[exports.PerkCategory.desert_rat]={name:g("desert rat"),desc:g("go twice as far without drinking"),notify:g("learned to love the dry air")},l[exports.PerkCategory.evasive]={name:g("evasive"),desc:g("dodge attacks more effectively"),notify:g("learned to be where they're not")},l[exports.PerkCategory.precise]={name:g("precise"),desc:g("land blows more often"),notify:g("learned to predict their movement")},l[exports.PerkCategory.scout]={name:g("scout"),desc:g("see farther"),notify:g("learned to look ahead")},l[exports.PerkCategory.stealthy]={name:g("stealthy"),desc:g("better avoid conflict in the wild"),notify:g("learned how not to be seen")},l[exports.PerkCategory.gastronome]={name:g("gastronome"),desc:g("restore more health when eating"),notify:g("learned to make the most of food")},l);(f=exports.Building||(exports.Building={})).trap="trap",f.cart="cart",f.hut="hut",f.lodge="lodge",f.trading_post="trading_post",f.tannery="tannery",f.smokehouse="smokehouse",f.workshop="workshop",f.steelworks="steelworks",f.armoury="armoury",f.sulphur_mine="sulphur_mine",f.iron_mine="iron_mine",f.coal_mine="coal_mine",(v=exports.Craftable||(exports.Craftable={})).trap="trap",v.cart="cart",v.hut="hut",v.lodge="lodge",v.trading_post="trading_post",v.tannery="tannery",v.smokehouse="smokehouse",v.workshop="workshop",v.steelworks="steelworks",v.armoury="armoury",v.torch="torch",v.waterskin="waterskin",v.cask="cask",v.water_tank="water_tank",v.bone_spear="bone_spear",v.rucksack="rucksack",v.wagon="wagon",v.convoy="convoy",v.l_armou="l_armou",v.i_armour="i_armour",v.s_armour="s_armour",v.iron_sword="iron_sword",v.steel_sword="steel_sword",v.rifle="rifle",function(e){e.medicine="medicine",e.charm="charm",e.bayonet="bayonet",e.bolas="bolas",e.grenade="grenade",e.bullets="bullets",e.cured_meat="cured_meat",e.laser_rifle="laser_rifle",e.energy_cell="energy_cell"}(x||(x={})),(b=exports.WorkerType||(exports.WorkerType={})).sulphur_miner="sulphur_miner",b.hunter="hunter",b.trapper="trapper",b.charcutier="charcutier",b.iron_miner="iron_miner",b.coal_miner="coal_miner",b.armourer="armourer",b.tanner="tanner",b.steelworker="steelworker";var S,w,E,k,O,_,L,A,W,M,D,C,R,T,N,G,P={gatherer:{name:g("gatherer"),delay:10,stores:{wood:1}},hunter:{name:g("hunter"),delay:10,stores:{fur:.5,meat:.5}},trapper:{name:g("trapper"),delay:10,stores:{meat:-1,bait:1}},tanner:{name:g("tanner"),delay:10,stores:{fur:-5,leather:1}},charcutier:{name:g("charcutier"),delay:10,stores:{meat:-5,wood:-5,cured_meat:1}},iron_miner:{name:g("iron miner"),delay:10,stores:{cured_meat:-1,iron:1}},coal_miner:{name:g("coal miner"),delay:10,stores:{cured_meat:-1,coal:1}},sulphur_miner:{name:g("sulphur miner"),delay:10,stores:{cured_meat:-1,sulphur:1}},steelworker:{name:g("steelworker"),delay:10,stores:{iron:-1,coal:-1,steel:1}},armourer:{name:g("armourer"),delay:10,stores:{steel:-1,sulphur:-1,bullets:1}}},I=t.createSlice({name:"marketing",initialState:{penrose:!1},reducers:{changePenrose:function(e,t){e.penrose=t.payload}}}),V=I.actions,F=I.reducer,H=t.createSlice({name:"config",initialState:{hyperMode:!1,soundOn:!1},reducers:{changeHyperMode:function(e,t){e.hyperMode=t.payload},changeSound:function(e,t){e.soundOn=t.payload}}}),U=H.actions,B=H.reducer,j=t.createSlice({name:"location",initialState:{Outside:!1,Room:!1,Ship:!1,World:!1,Path:!1},reducers:{enableOutside:function(e){e.Outside=!0},enableRoom:function(e){e.Room=!0},enableSpaceShip:function(e){e.Ship=!0},enableWorld:function(e){e.World=!0},enablePath:function(e){e.Path=!0}}}),Y=j.actions,z=t.combineReducers({location:j.reducer}),q={location:Y},K={trap:{name:g("trap"),type:"building",craft:{maximum:10,availableMsg:g("builder says she can make traps to catch any creatures might still be alive out there"),buildMsg:g("more traps to catch more creatures"),maxMsg:g("more traps won't help now"),type:"building",cost:function(e){return{wood:10+10*(e.game.buildings.trap||0)}}}},cart:{name:g("cart"),type:"building",craft:{maximum:1,availableMsg:g("builder says she can make a cart for carrying wood"),buildMsg:g("the rickety cart will carry more wood from the forest"),type:"building",cost:function(){return{wood:30}}}},hut:{name:g("hut"),type:"building",craft:{maximum:20,availableMsg:g("builder says there are more wanderers. says they'll work, too."),buildMsg:g("builder puts up a hut, out in the forest. says word will get around."),maxMsg:g("no more room for huts."),type:"building",cost:function(e){return{wood:100+50*(e.game.buildings.hut||0)}}}},lodge:{name:g("lodge"),type:"building",craft:{maximum:1,availableMsg:g("villagers could help hunt, given the means"),buildMsg:g("the hunting lodge stands in the forest, a ways out of town"),type:"building",cost:function(){return{wood:200,fur:10,meat:5}}}},trading_post:{name:g("trading post"),type:"building",craft:{maximum:1,availableMsg:g("a trading post would make commerce easier"),buildMsg:g("now the nomads have a place to set up shop, they might stick around a while"),type:"building",cost:function(){return{wood:400,fur:100}}}},tannery:{name:g("tannery"),type:"building",craft:{maximum:1,availableMsg:g("builder says leather could be useful. says the villagers could make it."),buildMsg:g("tannery goes up quick, on the edge of the village"),type:"building",cost:function(){return{wood:500,fur:50}}}},smokehouse:{name:g("smokehouse"),type:"building",craft:{maximum:1,availableMsg:g("should cure the meat, or it'll spoil. builder says she can fix something up."),buildMsg:g("builder finishes the smokehouse. she looks hungry."),type:"building",cost:function(){return{wood:600,meat:50}}}},workshop:{name:g("workshop"),type:"building",craft:{maximum:1,availableMsg:g("builder says she could make finer things, if she had the tools"),buildMsg:g("workshop's finally ready. builder's excited to get to it"),type:"building",cost:function(){return{wood:800,leather:100,scales:10}}}},steelworks:{name:g("steelworks"),type:"building",craft:{maximum:1,availableMsg:g("builder says the villagers could make steel, given the tools"),buildMsg:g("a haze falls over the village as the steelworks fires up"),type:"building",cost:function(){return{wood:1500,iron:100,coal:100}}}},armoury:{name:g("armoury"),type:"building",craft:{maximum:1,availableMsg:g("builder says it'd be useful to have a steady source of bullets"),buildMsg:g("armoury's done, welcoming back the weapons of the past."),type:"building",cost:function(){return{wood:3e3,steel:100,sulphur:50}}}},torch:{name:g("torch"),type:"tool",craft:{type:"tool",buildMsg:g("a torch to keep the dark away"),cost:function(){return{wood:1,cloth:1}}}},waterskin:{name:g("waterskin"),type:"upgrade",craft:{type:"upgrade",maximum:1,buildMsg:g("this waterskin'll hold a bit of water, at least"),cost:function(){return{leather:50}}}},cask:{name:g("cask"),type:"upgrade",craft:{type:"upgrade",maximum:1,buildMsg:g("the cask holds enough water for longer expeditions"),cost:function(){return{leather:100,iron:20}}}},water_tank:{name:g("water tank"),type:"upgrade",craft:{type:"upgrade",maximum:1,buildMsg:g("never go thirsty again"),cost:function(){return{iron:100,steel:50}}}},bone_spear:{name:g("bone spear"),type:"weapon",craft:{type:"weapon",buildMsg:g("this spear's not elegant, but it's pretty good at stabbing"),cost:function(){return{wood:100,teeth:5}}},weapon:{verb:g("stab"),type:"melee",damage:2,cooldown:2}},rucksack:{name:g("rucksack"),type:"upgrade",craft:{type:"upgrade",maximum:1,buildMsg:g("carrying more means longer expeditions to the wilds"),cost:function(){return{leather:200}}}},wagon:{name:g("wagon"),type:"upgrade",craft:{type:"upgrade",maximum:1,buildMsg:g("the wagon can carry a lot of supplies"),cost:function(){return{wood:500,iron:100}}}},convoy:{name:g("convoy"),type:"upgrade",craft:{type:"upgrade",maximum:1,buildMsg:g("the convoy can haul mostly everything"),cost:function(){return{wood:1e3,iron:200,steel:100}}}},l_armour:{name:g("l armour"),type:"upgrade",craft:{type:"upgrade",maximum:1,buildMsg:g("leather's not strong. better than rags, though."),cost:function(){return{leather:200,scales:20}}}},i_armour:{name:g("i armour"),type:"upgrade",craft:{type:"upgrade",maximum:1,buildMsg:g("iron's stronger than leather"),cost:function(){return{leather:200,iron:100}}}},s_armour:{name:g("s armour"),type:"upgrade",craft:{type:"upgrade",maximum:1,buildMsg:g("steel's stronger than iron"),cost:function(){return{leather:200,steel:100}}}},iron_sword:{name:g("iron sword"),type:"weapon",craft:{type:"weapon",buildMsg:g("sword is sharp. good protection out in the wilds."),cost:function(){return{wood:200,leather:50,iron:20}}},weapon:{verb:g("swing"),type:"melee",damage:4,cooldown:2}},steel_sword:{name:g("steel sword"),type:"weapon",craft:{type:"weapon",buildMsg:g("the steel is strong, and the blade true."),cost:function(){return{wood:500,leather:100,steel:20}}},weapon:{verb:g("slash"),type:"melee",damage:6,cooldown:2}},rifle:{name:g("rifle"),type:"weapon",craft:{type:"weapon",buildMsg:g("black powder and bullets, like the old days."),cost:function(){return{wood:200,steel:50,sulphur:50}}},weapon:{verb:g("shoot"),type:"ranged",damage:5,cooldown:1,cost:{bullets:1}}},cured_meat:{name:g("cured meat"),type:"tool",desc:g("restores")+" 8 "+g("hp")},bullets:{name:g("bullets"),type:"tool",desc:g("use with rifle"),trade:{type:"good",cost:function(){return{scales:10}}}},grenade:{name:g("grenade"),type:"weapon",weapon:{verb:g("lob"),type:"ranged",damage:15,cooldown:5,cost:{grenade:1}},trade:{type:"weapon",cost:function(){return{scales:100,teeth:50}}}},bolas:{name:g("bolas"),type:"weapon",weapon:{verb:g("tangle"),type:"ranged",damage:"stun",cooldown:15,cost:{bolas:1}},trade:{type:"weapon",cost:function(){return{teeth:10}}}},laser_rifle:{name:g("laser rifle"),type:"weapon",weapon:{verb:g("blast"),type:"ranged",damage:8,cooldown:1,cost:{energy_cell:1}}},energy_cell:{name:g("energy cell"),type:"tool",desc:g("emits a soft red glow"),trade:{type:"good",cost:function(){return{scales:10,teeth:10}}}},bayonet:{name:g("bayonet"),type:"weapon",weapon:{verb:g("thrust"),type:"melee",damage:8,cooldown:2},trade:{type:"weapon",cost:function(){return{scales:500,teeth:250}}}},charm:{name:g("charm"),type:"tool"},medicine:{name:g("medicine"),type:"tool",desc:g("restores")+" 20 "+g("hp"),trade:{type:"good",cost:function(){return{scales:50,teeth:30}}}},wood:{name:g("wood"),type:"resouce"},fur:{name:g("fur"),type:"resouce"},meat:{name:g("meat"),type:"resouce"},iron:{name:g("iron"),type:"resouce",trade:{type:"good",cost:function(){return{fur:150,scales:50}}}},coal:{name:g("coal"),type:"resouce",trade:{type:"good",cost:function(){return{fur:200,teeth:50}}}},sulphur:{name:g("sulphur"),type:"resouce"},steel:{name:g("steel"),type:"resouce",trade:{type:"good",cost:function(){return{fur:300,scales:50,teeth:50}}}},scales:{name:g("scales"),type:"resouce",trade:{type:"good",cost:function(){return{fur:150}}}},teeth:{name:g("teeth"),type:"resouce",trade:{type:"good",cost:function(){return{fur:300}}}},leather:{name:g("leather"),type:"resouce"},bait:{name:g("bait"),type:"resouce"},cloth:{name:g("cloth"),type:"resouce"},alien_alloy:{name:g("alien alloy"),type:"resouce",trade:{type:"good",cost:function(){return{fur:1500,scales:750,teeth:300}}}},compass:{name:g("compass"),type:"prop",trade:{type:"special",maximum:1,cost:function(){return{fur:400,scales:20,teeth:10}}}},fists:{name:g("fists"),type:"weapon",weapon:{verb:g("punch"),type:"unarmed",damage:1,cooldown:2}}};(R=exports.CraftableCategory||(exports.CraftableCategory={})).trap="trap",R.cart="cart",R.hut="hut",R.lodge="lodge",R.trading_post="trading_post",R.tannery="tannery",R.smokehouse="smokehouse",R.workshop="workshop",R.steelworks="steelworks",R.armoury="armoury",R.torch="torch",R.waterskin="waterskin",R.cask="cask",R.water_tank="water_tank",R.bone_spear="bone_spear",R.rucksack="rucksack",R.wagon="wagon",R.convoy="convoy",R.l_armour="l_armour",R.i_armour="i_armour",R.s_armour="s_armour",R.iron_sword="iron_sword",R.steel_sword="steel_sword",R.rifle="rifle",(T=exports.TradeCategory||(exports.TradeCategory={})).scales="scales",T.teeth="teeth",T.iron="iron",T.coal="coal",T.steel="steel",T.medicine="medicine",T.bullets="bullets",T.energy_cell="energy_cell",T.bolas="bolas",T.grenade="grenade",T.bayonet="bayonet",T.alien_alloy="alien_alloy",T.compass="compass",function(e){e.cured_meat="cured_meat",e.bullets="bullets",e.grenade="grenade",e.bolas="bolas",e.laser_rifle="laser_rifle",e.energy_cell="energy_cell",e.bayonet="bayonet",e.charm="charm",e.medicine="medicine"}(N||(N={})),(G=exports.WeaponCategory||(exports.WeaponCategory={})).fists="fists",G.bone_spear="bone_spear",G.iron_sword="iron_sword",G.steel_sword="steel_sword",G.bayonet="bayonet",G.rifle="rifle",G.laser_rifle="laser_rifle",G.grenade="grenade",G.bolas="bolas";var Q=Object.keys(i({},N,exports.CraftableCategory)).filter((function(e){var t=K[e];return"tool"===t.type||"weapon"===t.type})),$={VILLAGE:"A",IRON_MINE:"I",COAL_MINE:"C",SULPHUR_MINE:"S",FOREST:";",FIELD:",",BARRENS:".",ROAD:"#",HOUSE:"H",CAVE:"V",TOWN:"O",CITY:"Y",OUTPOST:"P",SHIP:"W",BOREHOLE:"B",BATTLEFIELD:"F",SWAMP:"M",CACHE:"U"},X={items:K,Engine:{VERSION:1.3,MAX_STORE:99999999999999,SAVE_DISPLAY:3e4},World:{name:"World",RADIUS:30,VILLAGE_POS:[30,30],TILE:$,TILE_PROBS:(S={},S[$.FOREST]=.15,S[$.FIELD]=.35,S[$.BARRENS]=.5,S),LANDMARKS:(w={},w[$.OUTPOST]={num:0,minRadius:0,maxRadius:0,scene:"outpost",label:g("An&nbsp;Outpost")},w[$.IRON_MINE]={num:1,minRadius:5,maxRadius:5,scene:"ironmine",label:g("Iron&nbsp;Mine")},w[$.COAL_MINE]={num:1,minRadius:10,maxRadius:10,scene:"coalmine",label:g("Coal&nbsp;Mine")},w[$.SULPHUR_MINE]={num:1,minRadius:20,maxRadius:20,scene:"sulphurmine",label:g("Sulphur&nbsp;Mine")},w[$.HOUSE]={num:10,minRadius:0,maxRadius:45,scene:"house",label:g("An&nbsp;Old&nbsp;House")},w[$.CAVE]={num:5,minRadius:3,maxRadius:10,scene:"cave",label:g("A&nbsp;Damp&nbsp;Cave")},w[$.TOWN]={num:10,minRadius:10,maxRadius:20,scene:"town",label:g("An&nbsp;Abandoned&nbsp;Town")},w[$.CITY]={num:20,minRadius:20,maxRadius:45,scene:"city",label:g("A&nbsp;Ruined&nbsp;City")},w[$.SHIP]={num:1,minRadius:28,maxRadius:28,scene:"ship",label:g("A&nbsp;Crashed&nbsp;Starship")},w[$.BOREHOLE]={num:10,minRadius:15,maxRadius:45,scene:"borehole",label:g("A&nbsp;Borehole")},w[$.BATTLEFIELD]={num:5,minRadius:18,maxRadius:45,scene:"battlefield",label:g("A&nbsp;Battlefield")},w[$.SWAMP]={num:1,minRadius:15,maxRadius:45,scene:"swamp",label:g("A&nbsp;Murky&nbsp;Swamp")},w),STICKINESS:.5,LIGHT_RADIUS:2,BASE_WATER:10,MOVES_PER_FOOD:2,MOVES_PER_WATER:1,DEATH_COOLDOWN:120,FIGHT_CHANCE:.2,BASE_HEALTH:10,BASE_HIT_CHANCE:.8,MEAT_HEAL:8,MEDS_HEAL:20,FIGHT_DELAY:3,NORTH:[0,-1],SOUTH:[0,1],WEST:[-1,0],EAST:[1,0]},Room:{name:"Room",FIRE_COOL_DELAY:3e5,ROOM_WARM_DELAY:3e4,BUILDER_STATE_DELAY:3e4,STOKE_COOLDOWN:10,NEED_WOOD_DELAY:15e3,MiscItems:["laser_rifle"],FireStatus:{Dead:{status:"Dead",value:0,text:g("dead")},Smoldering:{status:"Smoldering",value:1,text:g("smoldering")},Flickering:{status:"Flickering",value:2,text:g("flickering")},Burning:{status:"Burning",value:3,text:g("burning")},Roaring:{status:"Roaring",value:4,text:g("roaring")}},TemperatureStatus:{Freezing:{value:0,text:g("freezing")},Cold:{value:1,text:g("cold")},Mild:{value:2,text:g("mild")},Warm:{value:3,text:g("warm")},Hot:{value:4,text:g("hot")}}},Event:{EVENT_TIME_RANGE:[3,6],PANEL_FADE:200,FIGHT_SPEED:100,EAT_COOLDOWN:5,MEDS_COOLDOWN:7,LEAVE_COOLDOWN:1,STUN_DURATION:4e3},Outside:{name:g("Outside"),STORES_OFFSET:0,GATHER_DELAY:60,TRAPS_DELAY:90,POP_DELAY:[.5,3],HUT_ROOM:4,INCOME:{gatherer:{name:g("gatherer"),delay:10,stores:(E={},E[exports.StoreCategory.wood]=1,E)},hunter:{name:g("hunter"),delay:10,stores:(k={},k[exports.StoreCategory.fur]=.5,k[exports.StoreCategory.meat]=.5,k)},trapper:{name:g("trapper"),delay:10,stores:(O={},O[exports.StoreCategory.meat]=-1,O[exports.StoreCategory.bait]=1,O)},tanner:{name:g("tanner"),delay:10,stores:(_={},_[exports.StoreCategory.fur]=-5,_[exports.StoreCategory.leather]=1,_)},charcutier:{name:g("charcutier"),delay:10,stores:(L={},L[exports.StoreCategory.meat]=-5,L[exports.StoreCategory.wood]=-5,L[exports.StoreCategory.cured_meat]=1,L)},iron_miner:{name:g("iron miner"),delay:10,stores:(A={},A[exports.StoreCategory.cured_meat]=-1,A[exports.StoreCategory.iron]=1,A)},coal_miner:{name:g("coal miner"),delay:10,stores:(W={},W[exports.StoreCategory.cured_meat]=-1,W[exports.StoreCategory.coal]=1,W)},sulphur_miner:{name:g("sulphur miner"),delay:10,stores:(M={},M[exports.StoreCategory.cured_meat]=-1,M[exports.StoreCategory.sulphur]=1,M)},steelworker:{name:g("steelworker"),delay:10,stores:(D={},D[exports.StoreCategory.iron]=-1,D[exports.StoreCategory.coal]=-1,D[exports.StoreCategory.steel]=1,D)},armourer:{name:g("armourer"),delay:10,stores:(C={},C[exports.StoreCategory.steel]=-1,C[exports.StoreCategory.sulphur]=-1,C[exports.StoreCategory.bullets]=1,C)}},TrapDrops:[{rollUnder:.5,name:"fur",message:g("scraps of fur")},{rollUnder:.75,name:"meat",message:g("bits of meat")},{rollUnder:.85,name:"scales",message:g("strange scales")},{rollUnder:.93,name:"teeth",message:g("scattered teeth")},{rollUnder:.995,name:"cloth",message:g("tattered cloth")},{rollUnder:1,name:"charm",message:g("a crudely made charm")}]},Path:{DEFAULT_BAG_SPACE:10,STORES_OFFSET:0,Weight:{bone_spear:2,iron_sword:3,steel_sword:5,rifle:5,bullets:.1,energy_cell:.2,laser_rifle:5,bolas:.5},name:g("A Dusty Path"),Outfit:Q},Ship:{LIFTOFF_COOLDOWN:120,ALLOY_PER_HULL:1,ALLOY_PER_THRUSTER:1,BASE_HULL:0,BASE_THRUSTERS:1,name:g("Ship")},Space:{SHIP_SPEED:3,BASE_ASTEROID_DELAY:500,BASE_ASTEROID_SPEED:1500,FTB_SPEED:6e4,STAR_WIDTH:3e3,STAR_HEIGHT:3e3,NUM_STARS:200,STAR_SPEED:6e4,FRAME_DELAY:100},Prestige:{storesMap:[{store:exports.StoreCategory.wood,type:"g"},{store:exports.StoreCategory.fur,type:"g"},{store:exports.StoreCategory.meat,type:"g"},{store:exports.StoreCategory.iron,type:"g"},{store:exports.StoreCategory.coal,type:"g"},{store:exports.StoreCategory.sulphur,type:"g"},{store:exports.StoreCategory.steel,type:"g"},{store:exports.StoreCategory.cured_meat,type:"g"},{store:exports.StoreCategory.scales,type:"g"},{store:exports.StoreCategory.teeth,type:"g"},{store:exports.StoreCategory.leather,type:"g"},{store:exports.StoreCategory.bait,type:"g"},{store:exports.StoreCategory.torch,type:"g"},{store:exports.StoreCategory.cloth,type:"g"},{store:exports.StoreCategory.bone_spear,type:"w"},{store:exports.StoreCategory.iron_sword,type:"w"},{store:exports.StoreCategory.steel_sword,type:"w"},{store:exports.StoreCategory.bayonet,type:"w"},{store:exports.StoreCategory.rifle,type:"w"},{store:exports.StoreCategory.laser_rifle,type:"w"},{store:exports.StoreCategory.bullets,type:"a"},{store:exports.StoreCategory.energy_cell,type:"a"},{store:exports.StoreCategory.grenade,type:"a"},{store:exports.StoreCategory.bolas,type:"a"}]}};function J(e){var t=0;return"boolean"==typeof e?t=!1:"string"==typeof e?t="":null===e&&(t=null),t}var Z={clean:function(e,t){!function e(t,a){if(!a)return Object.keys(t).forEach((function(n){e(t,n)}));var r=n.get(t,a);if(n.isObject(r))for(var o in n.isEmpty(r)&&delete t[a],r)e(r[o],o)}(e,t.payload)},removeM:function(e,t){t.payload.forEach((function(t){n.unset(e,t)}))},set:function(e,t){var n=J(t.payload);return t.payload||n},setM:function(e,t){for(var a in t.payload)if(void 0===t.payload[a])n.set(e,a,void 0);else{var r=J(t.payload[a]);n.set(e,a,t.payload[a]||r)}},addM:function(e,t){for(var a in t.payload)n.set(e,a,Math.min(Math.max(n.get(e,a,0)+(t.payload[a]||0),0),X.Engine.MAX_STORE))}};function ee(){return Object.values(exports.StoreCategory).reduce((function(e,t){return e[t]=void 0,e}),{})}var te=t.createSlice({name:"stores",initialState:ee(),reducers:i({},Z)}),ne=te.actions,ae=te.reducer,re=t.createSlice({name:"fire",initialState:{status:X.Room.FireStatus.Dead},reducers:{changeFire:function(e,t){e.status=t.payload}}}),oe=i({},re.actions),ie=re.reducer,se=t.createSlice({name:"builder",initialState:{level:-1},reducers:i({},Z)}),ce=se.actions,le=se.reducer,ue=t.createSlice({name:"temperature",initialState:{status:X.Room.TemperatureStatus.Freezing},reducers:i({},Z,{change:function(e,t){e.status=t.payload}})}),de=ue.actions,he=ue.reducer,me=t.createSlice({name:"thieves",initialState:0,reducers:i({},Z,{change:function(e,t){return t.payload}})}),pe=me.actions,ge=me.reducer,fe=t.createSlice({name:"stolen",initialState:ee(),reducers:i({},Z)}),ve=fe.actions,xe=fe.reducer,be=t.createSlice({name:"stores",initialState:{},reducers:i({},Z)}),ye=be.actions,Se=be.reducer,we=t.createSlice({name:"population",initialState:{value:0},reducers:i({},Z)}),Ee=we.actions,ke=we.reducer,Oe=t.createSlice({name:"workers",initialState:{},reducers:i({},Z)}),_e=Oe.actions,Le=Oe.reducer,Ae=t.createSlice({name:"city",initialState:{cleared:!1},reducers:i({},Z)}),We=Ae.actions,Me=Ae.reducer,De=t.createSlice({name:"world",initialState:{seenAll:!1,mask:[],map:[],enableShip:!1,ship:[0,0],dir:"",sulphurmine:!1,ironmine:!1,coalmine:!1,water:0,danger:!1,foodMove:0,waterMove:0,starvation:!1,thirst:!1,usedOutposts:{},curPos:n.cloneDeep(X.World.VILLAGE_POS),health:0,dead:!1,fightMove:0,outfit:{},stunned:0},reducers:i({},Z,{seeAll:function(e,t){e.seenAll=t.payload},visit:function(e,t){var n=t.payload,a=n.x,r=n.y;e.map[a][r]=e.map[a][r].replace("!")+"!"},useOutpost:function(e){e.usedOutposts[e.curPos[0]+","+e.curPos[1]]=!0},setMap:function(e,t){var n=t.payload,a=n.pos;e.map[a[0]][a[1]]=n.value}})}),Ce=i({},De.actions),Re=De.reducer,Te=t.createSlice({name:"space_ship",initialState:{hull:0,thrusters:1,seenShip:!1,seenWarning:!1},reducers:i({},Z)}),Ne=Te.actions,Ge=Te.reducer,Pe=t.createSlice({name:"outside",initialState:{seenForest:!1},reducers:i({},Z)}),Ie=Pe.actions,Ve=t.combineReducers({fire:ie,builder:le,temperature:he,thieves:ge,stolen:xe,buildings:Se,population:ke,workers:Le,city:Me,world:Re,spaceShip:Ge,outside:Pe.reducer}),Fe={fire:oe,builder:ce,temperature:de,thieves:pe,stolen:ve,buildings:ye,population:Ee,workers:_e,city:We,world:Ce,spaceShip:Ne,outside:Ie},He=t.createAsyncThunk("notifications/notify",function(){var e=o(p.mark((function e(t,n){var a,r,o;return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=(0,n.getState)(),o=(r=t.message).module,r.text.slice(-1),!o||a.engine.activeSpace==o){e.next=9;break}if(t.noQueue){e.next=7;break}return e.abrupt("return",t.message);case 7:e.next=10;break;case 9:return e.abrupt("return",i({},t.message,{_module:t.message.module,module:"global"}));case 10:return e.abrupt("return",null);case 11:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),Ue=t.createSlice({name:"notifications",initialState:{notifyQueue:{global:[]}},reducers:{spaceNotify:function(e,t){var n=e.notifyQueue[t.payload]||[];e.notifyQueue[t.payload]=[],n.forEach((function(e){e._module=e.module,e.module="global"})),e.notifyQueue.global=[].concat(e.notifyQueue.global,n)}},extraReducers:function(e){e.addCase(He.fulfilled,(function(e,t){var n=t.payload;if(n){var a=n.module||"global";e.notifyQueue[a]||(e.notifyQueue[a]=[]),e.notifyQueue[a].push(n)}}))}}),Be=i({},Ue.actions,{notify:He}),je=Ue.reducer,Ye=t.createAsyncThunk("engine/changeSapce",function(){var e=o(p.mark((function e(t,n){var a;return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.dispatch,(0,n.getState)().engine.activeSpace!==t&&a(Be.spaceNotify(t)),e.abrupt("return",t);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),ze=t.createSlice({name:"engine",initialState:{activeSubSpace:""},reducers:{changeSubSpace:function(e,t){e.activeSubSpace=t.payload}},extraReducers:function(e){e.addCase(Ye.fulfilled,(function(e,t){e.activeSpace=t.payload}))}}),qe=i({},ze.actions,{changeSpace:Ye}),Ke=ze.reducer,Qe=t.createSlice({name:"income",initialState:{},reducers:i({},Z)}),$e=Qe.actions,Xe=Qe.reducer;function Je(){return Object.keys(y).reduce((function(e,t){return e[t]=!1,e}),{})}var Ze=t.createAsyncThunk("character/perks/add",function(){var e=o(p.mark((function e(t,n){return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(0,n.dispatch)(Be.notify({message:{text:y[t].notify}})),e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),et=t.createSlice({name:"perks",initialState:Je(),reducers:{},extraReducers:function(e){e.addCase(Ze.fulfilled,(function(e,t){e[t.payload]=!0}))}}),tt=i({},et.actions,{addPerk:Ze}),nt=et.reducer,at=t.createSlice({name:"statistics",initialState:{punches:0,starved:0,dehydrated:0,cityCleared:!1},reducers:i({},Z)}),rt=i({},at.actions),ot=t.combineReducers({perks:nt,statistics:at.reducer}),it={perks:tt,statistics:rt},st=t.createSlice({name:"events",initialState:{eventStack:[],activeScene:"",delay:{},loot:{},enemys:[],won:!1,fightEvents:[]},reducers:i({},Z,{end:function(e,t){e.eventStack.shift(),e.activeScene="",e.enemys=[],e.won=!1,e.fightEvents=[]},cleanEnemys:function(e){e.enemys=[],e.won=!1,e.fightEvents=[]},logFight:function(e,t){e.fightEvents||(e.fightEvents=[]),e.fightEvents.push(i({},t.payload,{id:"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))}))},push:function(e,t){e.eventStack.unshift(t.payload)},setSceneEnemy:function(e,t){var n=t.payload;e.enemys=[{chara:n.chara,health:n.health,maxHealth:n.health,stunned:0}],e.fightEvents=[],e.won=!1},winFight:function(e){e.won=!0}})}),ct=i({},st.actions),lt=st.reducer,ut=t.createSlice({name:"previous",initialState:{stores:[],score:0},reducers:i({},Z)}),dt=i({},ut.actions),ht=ut.reducer,mt=t.createSlice({name:"room",initialState:{changed:!0,crafts:{},buys:{}},reducers:{setChanged:function(e,t){e.changed=t.payload},addCraft:function(e,t){e.crafts[t.payload.name]=!0},addBuy:function(e,t){e.buys[t.payload.name]=!0}}}),pt=mt.actions,gt=mt.reducer,ft=t.createSlice({name:"outfit",initialState:{},reducers:i({},Z,{empty:function(){return{}}})}),vt=ft.actions,xt=t.combineReducers({outfit:ft.reducer}),bt={outfit:vt},yt=t.createSlice({name:"delay",initialState:{},reducers:i({},Z)}),St=i({},yt.actions),wt=yt.reducer,Et=t.createAsyncThunk("operation/record",function(){var e=o(p.mark((function e(t,n){var a,r,o;return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.extra,r=Date.now(),o=t.cooldown?t.cooldown(a.engine,t):0,e.abrupt("return",{lastExecTime:r,id:t.id,cooldown:o,cooldownAt:r+1e3*o});case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),kt=t.createSlice({name:"operation",initialState:{},reducers:{clearCooldown:function(e,t){var n=t.payload;e[n]&&(e[n].cooldownAt=0)}},extraReducers:function(e){e.addCase(Et.fulfilled,(function(e,t){var n=t.payload;e[n.id]=n}))}}),Ot=i({},kt.actions,{record:Et}),_t=t.combineReducers({room:gt,marketing:F,config:B,features:z,stores:ae,game:Ve,engine:Ke,income:Xe,character:ot,events:lt,notifications:je,previous:ht,path:xt,delay:wt,operation:kt.reducer}),Lt={config:U,stores:ne,game:Fe,engine:qe,income:$e,character:it,marketing:V,events:ct,notifications:Be,previous:dt,features:q,room:pt,path:bt,delay:St,operation:Ot},At=[],Wt=!1;function Mt(){var e;Wt&&(e=console).log.apply(e,arguments)}var Dt,Ct,Rt,Tt,Nt,Gt,Pt,It,Vt,Ft,Ht,Ut,Bt,jt,Yt=[{title:g("The Thief"),isAvailable:function(e){return(e.engine.activeSpace===exports.GameSpace.Room||e.engine.activeSpace===exports.GameSpace.Outside)&&1===e.game.thieves},scenes:{start:{text:[g("the villagers haul a filthy man out of the store room."),g("say his folk have been skimming the supplies."),g("say he should be strung up as an example.")],notification:g("a thief is caught"),blink:!0,buttons:{kill:{text:g("hang him"),nextScene:{1:"hang"}},spare:{text:g("spare him"),nextScene:{1:"spare"}}}},hang:{text:[g("the villagers hang the thief high in front of the store room."),g("the point is made. in the next few days, the missing supplies are returned.")],onLoad:function(e){var t,n,a,r;null==(t=e.store)||t.dispatch(e.actions.game.thieves.set(2)),null==(n=e.store)||n.dispatch(e.actions.income.setM({thieves:0})),null==(a=e.store)||a.dispatch(e.actions.stores.addM(null==(r=e.store)?void 0:r.getState().game.stolen))},buttons:{leave:{text:g("leave"),nextScene:"end"}}},spare:{text:[g("the man says he's grateful. says he won't come around any more."),g("shares what he knows about sneaking before he goes.")],onLoad:function(e){var t,n,a;null==(t=e.store)||t.dispatch(e.actions.game.thieves.set(2)),null==(n=e.store)||n.dispatch(e.actions.income.setM({thieves:0})),null==(a=e.store)||a.dispatch(e.actions.character.perks.addPerk(exports.PerkCategory.stealthy))},buttons:{leave:{text:g("leave"),nextScene:"end"}}}}}],zt=[{title:g("The Nomad"),isAvailable:function(e){return e.engine.activeSpace===exports.GameSpace.Room&&!!e.stores.fur},scenes:{start:{text:[g("a nomad shuffles into view, laden with makeshift bags bound with rough twine."),g("won't say from where he came, but it's clear that he's not staying.")],notification:g("a nomad arrives, looking to trade"),blink:!0,buttons:{buyScales:{text:g("buy scales"),cost:{fur:100},reward:{scales:1}},buyTeeth:{text:g("buy teeth"),cost:{fur:200},reward:{teeth:1}},buyBait:{text:g("buy bait"),cost:{fur:5},reward:{bait:1},notification:g("traps are more effective with bait.")},buyCompass:{available:function(e){return!!e.stores.compass},text:g("buy compass"),cost:{fur:300,scales:15,teeth:5},reward:{compass:1},notification:g("the old compass is dented and dusty, but it looks to work.")},goodbye:{text:g("say goodbye"),nextScene:"end"}}}}},{title:g("Noises"),isAvailable:function(e){return e.engine.activeSpace===exports.GameSpace.Room&&!!e.stores.wood},scenes:{start:{text:[g("through the walls, shuffling noises can be heard."),g("can't tell what they're up to.")],notification:g("strange noises can be heard through the walls"),blink:!0,buttons:{investigate:{text:g("investigate"),nextScene:{.3:"stuff",1:"nothing"}},ignore:{text:g("ignore them"),nextScene:"end"}}},nothing:{text:[g("vague shapes move, just out of sight."),g("the sounds stop.")],buttons:{backinside:{text:g("go back inside"),nextScene:"end"}}},stuff:{reward:{wood:100,fur:10},text:[g("a bundle of sticks lies just beyond the threshold, wrapped in coarse furs."),g("the night is silent.")],buttons:{backinside:{text:g("go back inside"),nextScene:"end"}}}}},{title:g("Noises"),isAvailable:function(e){return e.engine.activeSpace===exports.GameSpace.Room&&!!e.stores.wood},scenes:{start:{text:[g("scratching noises can be heard from the store room."),g("something's in there.")],notification:g("something's in the store room"),blink:!0,buttons:{investigate:{text:g("investigate"),nextScene:{.5:"scales",.8:"teeth",1:"cloth"}},ignore:{text:g("ignore them"),nextScene:"end"}}},scales:{text:[g("some wood is missing."),g("the ground is littered with small scales")],onLoad:function(e){var t,n,a=null==(t=e.store)?void 0:t.getState(),r=(null==a?void 0:a.stores.wood)||0;0===(r=Math.floor(.1*r))&&(r=1);var o=Math.floor(r/5);0===o&&(o=1),null==(n=e.store)||n.dispatch(e.actions.stores.addM({wood:-r,scales:o}))},buttons:{leave:{text:g("leave"),nextScene:"end"}}},teeth:{text:[g("some wood is missing."),g("the ground is littered with small teeth")],onLoad:function(e){var t,n,a=null==(t=e.store)?void 0:t.getState(),r=(null==a?void 0:a.stores.wood)||0;0===(r=Math.floor(.1*r))&&(r=1);var o=Math.floor(r/5);0===o&&(o=1),null==(n=e.store)||n.dispatch(e.actions.stores.addM({wood:-r,teeth:o}))},buttons:{leave:{text:g("leave"),nextScene:"end"}}},cloth:{text:[g("some wood is missing."),g("the ground is littered with scraps of cloth")],onLoad:function(e){var t,n,a=null==(t=e.store)?void 0:t.getState(),r=(null==a?void 0:a.stores.wood)||0;0===(r=Math.floor(.1*r))&&(r=1);var o=Math.floor(r/5);0===o&&(o=1),null==(n=e.store)||n.dispatch(e.actions.stores.addM({wood:-r,cloth:o}))},buttons:{leave:{text:g("leave"),nextScene:"end"}}}}},{title:g("The Beggar"),isAvailable:function(e){return e.engine.activeSpace===exports.GameSpace.Room&&!!e.stores.fur},scenes:{start:{text:[g("a beggar arrives."),g("asks for any spare furs to keep him warm at night.")],notification:g("a beggar arrives"),blink:!0,buttons:{"50furs":{text:g("give 50"),cost:{fur:50},nextScene:{.5:"scales",.8:"teeth",1:"cloth"}},"100furs":{text:g("give 100"),cost:{fur:100},nextScene:{.5:"teeth",.8:"scales",1:"cloth"}},deny:{text:g("turn him away"),nextScene:"end"}}},scales:{reward:{scales:20},text:[g("the beggar expresses his thanks."),g("leaves a pile of small scales behind.")],buttons:{leave:{text:g("say goodbye"),nextScene:"end"}}},teeth:{reward:{teeth:20},text:[g("the beggar expresses his thanks."),g("leaves a pile of small teeth behind.")],buttons:{leave:{text:g("say goodbye"),nextScene:"end"}}},cloth:{reward:{cloth:20},text:[g("the beggar expresses his thanks."),g("leaves some scraps of cloth behind.")],buttons:{leave:{text:g("say goodbye"),nextScene:"end"}}}}},{title:g("The Shady Builder"),isAvailable:function(e){return e.engine.activeSpace===exports.GameSpace.Room&&e.game.buildings.hut>=5&&e.game.buildings.hut<20},scenes:{start:{text:[g("a shady builder passes through"),g("says he can build you a hut for less wood")],notification:g("a shady builder passes through"),buttons:{build:{text:g("300 wood"),cost:{wood:300},nextScene:{.6:"steal",1:"build"}},deny:{text:g("say goodbye"),nextScene:"end"}}},steal:{text:[g("the shady builder has made off with your wood")],notification:g("the shady builder has made off with your wood"),buttons:{end:{text:g("go home"),nextScene:"end"}}},build:{text:[g("the shady builder builds a hut")],notification:g("the shady builder builds a hut"),onLoad:function(e){var t,n,a=(null==(t=e.store)?void 0:t.getState()).game.buildings.hut;a<20&&(null==(n=e.store)||n.dispatch(e.actions.game.buildings.setM({hut:a+1})))},buttons:{end:{text:g("go home"),nextScene:"end"}}}}},{title:g("The Mysterious Wanderer"),isAvailable:function(e){return e.engine.activeSpace===exports.GameSpace.Room&&!!e.stores.wood},scenes:{start:{text:[g("a wanderer arrives with an empty cart. says if he leaves with wood, he'll be back with more."),g("builder's not sure he's to be trusted.")],notification:g("a mysterious wanderer arrives"),blink:!0,buttons:{wood100:{text:g("give 100"),cost:{wood:100},nextScene:{1:"wood100"}},wood500:{text:g("give 500"),cost:{wood:500},nextScene:{1:"wood500"}},deny:{text:g("turn him away"),nextScene:"end"}}},wood100:{text:[g("the wanderer leaves, cart loaded with wood")],action:function(e,t){t.events.saveDelay((function(e){var t;null==(t=e.store)||t.dispatch(e.actions.stores.addM({wood:300})),e.notify("the mysterious wanderer returns, cart piled high with wood.",exports.GameSpace.Room)}),exports.GameSpace.Room+"[4].scenes.wood100.action",e)},onLoad:function(e){Math.random()<.5&&this.action(60,e)},buttons:{leave:{text:g("say goodbye"),nextScene:"end"}}},wood500:{text:[g("the wanderer leaves, cart loaded with wood")],action:function(e,t){t.events.saveDelay((function(e){var t;null==(t=e.store)||t.dispatch(e.actions.stores.addM({wood:1500})),e.notify("the mysterious wanderer returns, cart piled high with wood.",exports.GameSpace.Room)}),exports.GameSpace.Room+"[4].scenes.wood500.action",e)},onLoad:function(e){Math.random()<.3&&this.action(60,e)},buttons:{leave:{text:g("say goodbye"),nextScene:"end"}}}}},{title:g("The Mysterious Wanderer"),isAvailable:function(e){return e.engine.activeSpace===exports.GameSpace.Room&&!!e.stores.fur},scenes:{start:{text:[g("a wanderer arrives with an empty cart. says if she leaves with furs, she'll be back with more."),g("builder's not sure she's to be trusted.")],notification:g("a mysterious wanderer arrives"),blink:!0,buttons:{fur100:{text:g("give 100"),cost:{fur:100},nextScene:{1:"fur100"}},fur500:{text:g("give 500"),cost:{fur:500},nextScene:{1:"fur500"}},deny:{text:g("turn her away"),nextScene:"end"}}},fur100:{text:[g("the wanderer leaves, cart loaded with furs")],action:function(e,t){t.events.saveDelay((function(e){var t;null==(t=e.store)||t.dispatch(e.actions.stores.addM({fur:300})),e.notify("the mysterious wanderer returns, cart piled high with furs.",exports.GameSpace.Room)}),exports.GameSpace.Room+"[5].scenes.fur100.action",e)},onLoad:function(e){Math.random()<.5&&this.action(60,e)},buttons:{leave:{text:g("say goodbye"),nextScene:"end"}}},fur500:{text:[g("the wanderer leaves, cart loaded with furs")],action:function(e,t){t.events.saveDelay((function(e){var t;null==(t=e.store)||t.dispatch(e.actions.stores.addM({fur:1500})),e.notify("the mysterious wanderer returns, cart piled high with furs.",exports.GameSpace.Room)}),exports.GameSpace.Room+"[5].scenes.fur500.action",e)},onLoad:function(e){Math.random()<.3&&this.action(60,e)},buttons:{leave:{text:g("say goodbye"),nextScene:"end"}}}}},{title:g("The Scout"),isAvailable:function(e){return e.engine.activeSpace===exports.GameSpace.Room&&e.features.location.World},scenes:{start:{text:[g("the scout says she's been all over."),g("willing to talk about it, for a price.")],notification:g("a scout stops for the night"),blink:!0,buttons:{buyMap:{text:g("buy map"),cost:{fur:200,scales:10},available:function(e){return!e.game.world.seenAll},notification:g("the map uncovers a bit of the world"),onChoose:function(e){e.spaces[exports.GameSpace.World].applyMap()}},learn:{text:g("learn scouting"),cost:{fur:1e3,scales:50,teeth:20},available:function(e){return!e.character.perks.scout},onChoose:function(e){var t;null==(t=e.store)||t.dispatch(e.actions.character.perks.addPerk(exports.PerkCategory.scout))}},leave:{text:g("say goodbye"),nextScene:"end"}}}}},{title:g("The Master"),isAvailable:function(e){return e.engine.activeSpace===exports.GameSpace.Room&&e.features.location.World},scenes:{start:{text:[g("an old wanderer arrives."),g("he smiles warmly and asks for lodgings for the night.")],notification:g("an old wanderer arrives"),blink:!0,buttons:{agree:{text:g("agree"),cost:{cured_meat:100,fur:100,torch:1},nextScene:{1:"agree"}},deny:{text:g("turn him away"),nextScene:"end"}}},agree:{text:[g("in exchange, the wanderer offers his wisdom.")],buttons:{evasion:{text:g("evasion"),available:function(e){return!e.character.perks.evasive},onChoose:function(e){var t;null==(t=e.store)||t.dispatch(e.actions.character.perks.addPerk(exports.PerkCategory.evasive))},nextScene:"end"},precision:{text:g("precision"),available:function(e){return!e.character.perks.precise},onChoose:function(e){var t;null==(t=e.store)||t.dispatch(e.actions.character.perks.addPerk(exports.PerkCategory.precise))},nextScene:"end"},force:{text:g("force"),available:function(e){return!e.character.perks.barbarian},onChoose:function(e){var t;null==(t=e.store)||t.dispatch(e.actions.character.perks.addPerk(exports.PerkCategory.barbarian))},nextScene:"end"},nothing:{text:g("nothing"),nextScene:"end"}}}}},{title:g("The Sick Man"),isAvailable:function(e){return e.engine.activeSpace===exports.GameSpace.Room&&!!e.stores.medicine},scenes:{start:{text:[g("a man hobbles up, coughing."),g("he begs for medicine.")],notification:g("a sick man hobbles up"),blink:!0,buttons:{help:{text:g("give 1 medicine"),cost:{medicine:1},notification:g("the man swallows the medicine eagerly"),nextScene:{.1:"alloy",.3:"cells",.5:"scales",1:"nothing"}},ignore:{text:g("tell him to leave"),nextScene:"end"}}},alloy:{text:[g("the man is thankful."),g("he leaves a reward."),g("some weird metal he picked up on his travels.")],onLoad:function(e){var t,n;null==(t=e.store)||t.dispatch(e.actions.stores.addM(((n={})[exports.StoreCategory.alien_alloy]=1,n)))},buttons:{bye:{text:g("say goodbye"),nextScene:"end"}}},cells:{text:[g("the man is thankful."),g("he leaves a reward."),g("some weird glowing boxes he picked up on his travels.")],onLoad:function(e){var t,n;null==(t=e.store)||t.dispatch(e.actions.stores.addM(((n={})[exports.StoreCategory.energy_cell]=3,n)))},buttons:{bye:{text:g("say goodbye"),nextScene:"end"}}},scales:{text:[g("the man is thankful."),g("he leaves a reward."),g("all he has are some scales.")],onLoad:function(e){var t,n;null==(t=e.store)||t.dispatch(e.actions.stores.addM(((n={})[exports.StoreCategory.scales]=5,n)))},buttons:{bye:{text:g("say goodbye"),nextScene:"end"}}},nothing:{text:[g("the man expresses his thanks and hobbles off.")],buttons:{bye:{text:g("say goodbye"),nextScene:"end"}}}}}],qt=[{title:g("A Ruined Trap"),isAvailable:function(e){return e.engine.activeSpace===exports.GameSpace.Outside&&e.game.buildings.trap>0},scenes:{start:{text:[g("some of the traps have been torn apart."),g("large prints lead away, into the forest.")],onLoad:function(e){var t,n,a=null==(t=e.store)?void 0:t.getState(),r=Math.floor(Math.random()*a.game.buildings.trap)+1;null==(n=e.store)||n.dispatch(e.actions.game.buildings.addM({trap:-r}))},notification:g("some traps have been destroyed"),blink:!0,buttons:{track:{text:g("track them"),nextScene:{.5:"nothing",1:"catch"}},ignore:{text:g("ignore them"),nextScene:"end"}}},nothing:{text:[g("the tracks disappear after just a few minutes."),g("the forest is silent.")],notification:g("nothing was found"),buttons:{end:{text:g("go home"),nextScene:"end"}}},catch:{text:[g("not far from the village lies a large beast, its fur matted with blood."),g("it puts up little resistance before the knife.")],notification:g("there was a beast. it's dead now"),reward:{fur:100,meat:100,teeth:10},buttons:{end:{text:g("go home"),nextScene:"end"}}}}},{title:g("Fire"),isAvailable:function(e){return e.engine.activeSpace==exports.GameSpace.Outside&&e.game.buildings.hut>0&&e.game.population.value>50},scenes:{start:{text:[g("a fire rampages through one of the huts, destroying it."),g("all residents in the hut perished in the fire.")],notification:g("a fire has started"),blink:!0,onLoad:function(e){e.spaces.Outside.destroyHuts(1)},buttons:{mourn:{text:g("mourn"),notification:g("some villagers have died"),nextScene:"end"}}}}},{title:g("Sickness"),isAvailable:function(e){return e.engine.activeSpace==exports.GameSpace.Outside&&e.game.population.value>10&&e.game.population.value<50&&!!e.stores.medicine},scenes:{start:{text:[g("a sickness is spreading through the village."),g("medicine is needed immediately.")],notification:g("some villagers are ill"),blink:!0,buttons:{heal:{text:g("1 medicine"),cost:{medicine:1},nextScene:{1:"healed"}},ignore:{text:g("ignore it"),nextScene:{1:"death"}}}},healed:{text:[g("the sickness is cured in time.")],notification:g("sufferers are healed"),buttons:{end:{text:g("go home"),nextScene:"end"}}},death:{text:[g("the sickness spreads through the village."),g("the days are spent with burials."),g("the nights are rent with screams.")],notification:g("sufferers are left to die"),onLoad:function(e){var t,n=null==(t=e.store)?void 0:t.getState(),a=Math.floor(Math.random()*Math.floor(n.game.population.value/2))+1;e.spaces.Outside.killVillagers(a)},buttons:{end:{text:g("go home"),nextScene:"end"}}}}},{title:g("Plague"),isAvailable:function(e){return e.engine.activeSpace==exports.GameSpace.Outside&&e.game.population.value>50&&!!e.stores.medicine},scenes:{start:{text:[g("a terrible plague is fast spreading through the village."),g("medicine is needed immediately.")],notification:g("a plague afflicts the village"),blink:!0,buttons:{buyMedicine:{text:g("buy medicine"),cost:{scales:70,teeth:50},reward:{medicine:1}},heal:{text:g("5 medicine"),cost:{medicine:5},nextScene:{1:"healed"}},ignore:{text:g("do nothing"),nextScene:{1:"death"}}}},healed:{text:[g("the plague is kept from spreading."),g("only a few die."),g("the rest bury them.")],notification:g("epidemic is eradicated eventually"),onLoad:function(e){var t=Math.floor(5*Math.random())+2;e.spaces.Outside.killVillagers(t)},buttons:{end:{text:g("go home"),nextScene:"end"}}},death:{text:[g("the plague rips through the village."),g("the nights are rent with screams."),g("the only hope is a quick death.")],notification:g("population is almost exterminated"),onLoad:function(e){var t=Math.floor(80*Math.random())+10;e.spaces.Outside.killVillagers(t)},buttons:{end:{text:g("go home"),nextScene:"end"}}}}},{title:g("A Beast Attack"),isAvailable:function(e){return e.engine.activeSpace==exports.GameSpace.Outside&&e.game.population.value>0},scenes:{start:{text:[g("a pack of snarling beasts pours out of the trees."),g("the fight is short and bloody, but the beasts are repelled."),g("the villagers retreat to mourn the dead.")],notification:g("wild beasts attack the villagers"),onLoad:function(e){var t=Math.floor(10*Math.random())+1;e.spaces.Outside.killVillagers(t)},reward:{fur:100,meat:100,teeth:10},blink:!0,buttons:{end:{text:g("go home"),notification:g("predators become prey. price is unfair"),nextScene:"end"}}}}},{title:g("A Military Raid"),isAvailable:function(e){return e.engine.activeSpace==exports.GameSpace.Outside&&e.game.population.value>0&&e.game.city.cleared},scenes:{start:{text:[g("a gunshot rings through the trees."),g("well armed men charge out of the forest, firing into the crowd."),g("after a skirmish they are driven away, but not without losses.")],notification:g("troops storm the village"),onLoad:function(e){var t=Math.floor(40*Math.random())+1;e.spaces.Outside.killVillagers(t)},reward:(Dt={},Dt[exports.StoreCategory.bullets]=10,Dt[exports.StoreCategory.cured_meat]=50,Dt),blink:!0,buttons:{end:{text:g("go home"),notification:g("warfare is bloodthirsty"),nextScene:"end"}}}}}],Kt=[],Qt={outpost:{title:g("An Outpost"),id:"outpost",scenes:{start:{text:[g("a safe place in the wilds.")],notification:g("a safe place in the wilds."),loot:{cured_meat:{min:5,max:10,chance:1}},onLoad:function(e){e.spaces.World.useOutpost()},buttons:{leave:{text:g("leave"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:"end"}}}}},swamp:{title:g("A Murky Swamp"),id:"swamp",scenes:{start:{text:[g("rotting reeds rise out of the swampy earth."),g("a lone frog sits in the muck, silently.")],notification:g("a swamp festers in the stagnant air."),buttons:{enter:{text:g("enter"),nextScene:{1:"cabin"}},leave:{text:g("leave"),nextScene:"end"}}},cabin:{text:[g("deep in the swamp is a moss-covered cabin."),g("an old wanderer sits inside, in a seeming trance.")],buttons:{talk:{cost:{charm:1},text:g("talk"),nextScene:{1:"talk"}},leave:{text:g("leave"),nextScene:"end"}}},talk:{text:[g("the wanderer takes the charm and nods slowly."),g("he speaks of once leading the great fleets to fresh worlds."),g("unfathomable destruction to fuel wanderer hungers."),g("his time here, now, is his penance.")],onLoad:function(e){var t=e.store.getState();e.dispatch(e.actions.character.perks.addPerk(exports.PerkCategory.gastronome)),e.spaces.World.markVisited(null==t?void 0:t.game.world.curPos[0],null==t?void 0:t.game.world.curPos[1])},buttons:{leave:{text:g("leave"),nextScene:"end"}}}}},cave:{title:g("A Damp Cave"),id:"cave",scenes:{start:{text:[g("the mouth of the cave is wide and dark."),g("can't see what's inside.")],notification:g("the earth here is split, as if bearing an ancient wound"),buttons:{enter:{text:g("go inside"),cost:{torch:1},nextScene:{.3:"a1",.6:"a2",1:"a3"}},leave:{text:g("leave"),nextScene:"end"}}},a1:{combat:!0,enemy:"beast",chara:"R",damage:1,hit:.8,attackDelay:1,health:5,notification:g("a startled beast defends its home"),loot:{fur:{min:1,max:10,chance:1},teeth:{min:1,max:5,chance:.8}},buttons:{continue:{text:g("continue"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:{.5:"b1",1:"b2"}},leave:{text:g("leave cave"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:"end"}}},a2:{text:[g("the cave narrows a few feet in."),g("the walls are moist and moss-covered")],buttons:{continue:{text:g("squeeze"),nextScene:{.5:"b2",1:"b3"}},leave:{text:g("leave cave"),nextScene:"end"}}},a3:{text:[g("the remains of an old camp sits just inside the cave."),g("bedrolls, torn and blackened, lay beneath a thin layer of dust.")],loot:{cured_meat:{min:1,max:5,chance:1},torch:{min:1,max:5,chance:.5},leather:{min:1,max:5,chance:.3}},buttons:{continue:{text:g("continue"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:{.5:"b3",1:"b4"}},leave:{text:g("leave cave"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:"end"}}},b1:{text:[g("the body of a wanderer lies in a small cavern."),g("rot's been to work on it, and some of the pieces are missing."),g("can't tell what left it here.")],loot:{iron_sword:{min:1,max:1,chance:1},cured_meat:{min:1,max:5,chance:.8},torch:{min:1,max:3,chance:.5},medicine:{min:1,max:2,chance:.1}},buttons:{continue:{text:g("continue"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:{1:"c1"}},leave:{text:g("leave cave"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:"end"}}},b2:{text:[g("the torch sputters and dies in the damp air"),g("the darkness is absolute")],notification:g("the torch goes out"),buttons:{continue:{text:g("continue"),cost:{torch:1},nextScene:{1:"c1"}},leave:{text:g("leave cave"),nextScene:"end"}}},b3:{combat:!0,enemy:"beast",chara:"R",damage:1,hit:.8,attackDelay:1,health:5,notification:g("a startled beast defends its home"),loot:{fur:{min:1,max:3,chance:1},teeth:{min:1,max:2,chance:.8}},buttons:{continue:{text:g("continue"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:{1:"c2"}},leave:{text:g("leave cave"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:"end"}}},b4:{combat:!0,enemy:"cave lizard",chara:"R",damage:3,hit:.8,attackDelay:2,health:6,notification:g("a cave lizard attacks"),loot:{scales:{min:1,max:3,chance:1},teeth:{min:1,max:2,chance:.8}},buttons:{continue:{text:g("continue"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:{1:"c2"}},leave:{text:g("leave cave"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:"end"}}},c1:{combat:!0,enemy:"beast",chara:"R",damage:3,hit:.8,attackDelay:2,health:10,notification:g("a large beast charges out of the dark"),loot:{fur:{min:1,max:3,chance:1},teeth:{min:1,max:3,chance:1}},buttons:{continue:{text:g("continue"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:{.5:"end1",1:"end2"}},leave:{text:g("leave cave"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:"end"}}},c2:{combat:!0,enemy:"lizard",chara:"T",damage:4,hit:.8,attackDelay:2,health:10,notification:g("a giant lizard shambles forward"),loot:{scales:{min:1,max:3,chance:1},teeth:{min:1,max:3,chance:1}},buttons:{continue:{text:g("continue"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:{.7:"end2",1:"end3"}},leave:{text:g("leave cave"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:"end"}}},end1:{text:[g("the nest of a large animal lies at the back of the cave.")],onLoad:function(e){e.spaces.World.clearDungeon()},loot:{meat:{min:5,max:10,chance:1},fur:{min:5,max:10,chance:1},scales:{min:5,max:10,chance:1},teeth:{min:5,max:10,chance:1},cloth:{min:5,max:10,chance:.5}},buttons:{leave:{text:g("leave cave"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:"end"}}},end2:{text:[g("a small supply cache is hidden at the back of the cave.")],loot:{cloth:{min:5,max:10,chance:1},leather:{min:5,max:10,chance:1},iron:{min:5,max:10,chance:1},cured_meat:{min:5,max:10,chance:1},steel:{min:5,max:10,chance:.5},bolas:{min:1,max:3,chance:.3},medicine:{min:1,max:4,chance:.15}},onLoad:function(e){e.spaces.World.clearDungeon()},buttons:{leave:{text:g("leave cave"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:"end"}}},end3:{text:[g("an old case is wedged behind a rock, covered in a thick layer of dust.")],loot:{steel_sword:{min:1,max:1,chance:1},bolas:{min:1,max:3,chance:.5},medicine:{min:1,max:3,chance:.3}},onLoad:function(e){e.spaces.World.clearDungeon()},buttons:{leave:{text:g("leave cave"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:"end"}}}}},town:{title:g("A Deserted Town"),id:"town",scenes:{start:{text:[g("a small suburb lays ahead, empty houses scorched and peeling."),g("broken streetlights stand, rusting. light hasn't graced this place in a long time.")],notification:g("the town lies abandoned, its citizens long dead"),buttons:{enter:{text:g("explore"),nextScene:{.3:"a1",.7:"a3",1:"a2"}},leave:{text:g("leave"),nextScene:"end"}}},a1:{text:[g("where the windows of the schoolhouse aren't shattered, they're blackened with soot."),g("the double doors creak endlessly in the wind.")],buttons:{enter:{text:g("enter"),nextScene:{.5:"b1",1:"b2"},cost:{torch:1}},leave:{text:g("leave town"),nextScene:"end"}}},a2:{combat:!0,enemy:"thug",chara:"E",damage:4,hit:.8,attackDelay:2,health:30,loot:{cloth:{min:5,max:10,chance:.8},leather:{min:5,max:10,chance:.8},cured_meat:{min:1,max:5,chance:.5}},notification:g("ambushed on the street."),buttons:{continue:{text:g("continue"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:{.5:"b3",1:"b4"}},leave:{text:g("leave town"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:"end"}}},a3:{text:[g("a squat building up ahead."),g("a green cross barely visible behind grimy windows.")],buttons:{enter:{text:g("enter"),nextScene:{.5:"b5",1:"end5"},cost:{torch:1}},leave:{text:g("leave town"),nextScene:"end"}}},b1:{text:[g("a small cache of supplies is tucked inside a rusting locker.")],loot:{cured_meat:{min:1,max:5,chance:1},torch:{min:1,max:3,chance:.8},bullets:{min:1,max:5,chance:.3},medicine:{min:1,max:3,chance:.05}},buttons:{continue:{text:g("continue"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:{.5:"c1",1:"c2"}},leave:{text:g("leave town"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:"end"}}},b2:{combat:!0,enemy:"scavenger",chara:"E",damage:4,hit:.8,attackDelay:2,health:30,loot:{cloth:{min:5,max:10,chance:.8},leather:{min:5,max:10,chance:.8},cured_meat:{min:1,max:5,chance:.5}},notification:g("a scavenger waits just inside the door."),buttons:{continue:{text:g("continue"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:{.5:"c2",1:"c3"}},leave:{text:g("leave town"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:"end"}}},b3:{combat:!0,enemy:"beast",chara:"R",damage:3,hit:.8,attackDelay:1,health:25,loot:{teeth:{min:1,max:5,chance:1},fur:{min:5,max:10,chance:1}},notification:g("a beast stands alone in an overgrown park."),buttons:{continue:{text:g("continue"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:{.5:"c4",1:"c5"}},leave:{text:g("leave town"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:"end"}}},b4:{text:[g("an overturned caravan is spread across the pockmarked street."),g("it's been picked over by scavengers, but there's still some things worth taking.")],loot:{cured_meat:{min:1,max:5,chance:.8},torch:{min:1,max:3,chance:.5},bullets:{min:1,max:5,chance:.3},medicine:{min:1,max:3,chance:.1}},buttons:{continue:{text:g("continue"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:{.5:"c5",1:"c6"}},leave:{text:g("leave town"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:"end"}}},b5:{combat:!0,enemy:"madman",chara:"E",damage:6,hit:.3,attackDelay:1,health:10,loot:{cloth:{min:2,max:4,chance:.3},cured_meat:{min:1,max:5,chance:.9},medicine:{min:1,max:2,chance:.4}},notification:g("a madman attacks, screeching."),buttons:{continue:{text:g("continue"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:{.3:"end5",1:"end6"}},leave:{text:g("leave town"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:"end"}}},c1:{combat:!0,enemy:"thug",chara:"E",damage:4,hit:.8,attackDelay:2,health:30,loot:{cloth:{min:5,max:10,chance:.8},leather:{min:5,max:10,chance:.8},cured_meat:{min:1,max:5,chance:.5}},notification:g("a thug moves out of the shadows."),buttons:{continue:{text:g("continue"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:{1:"d1"}},leave:{text:g("leave town"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:"end"}}},c2:{combat:!0,enemy:"beast",chara:"R",damage:3,hit:.8,attackDelay:1,health:25,loot:{teeth:{min:1,max:5,chance:1},fur:{min:5,max:10,chance:1}},notification:g("a beast charges out of a ransacked classroom."),buttons:{continue:{text:g("continue"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:{1:"d1"}},leave:{text:g("leave town"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:"end"}}},c3:{text:[g("through the large gymnasium doors, footsteps can be heard."),g("the torchlight casts a flickering glow down the hallway."),g("the footsteps stop.")],buttons:{continue:{text:g("enter"),nextScene:{1:"d1"}},leave:{text:g("leave town"),nextScene:"end"}}},c4:{combat:!0,enemy:"beast",chara:"R",damage:4,hit:.8,attackDelay:1,health:25,loot:{teeth:{min:1,max:5,chance:1},fur:{min:5,max:10,chance:1}},notification:g("another beast, draw by the noise, leaps out of a copse of trees."),buttons:{continue:{text:g("continue"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:{1:"d2"}},leave:{text:g("leave town"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:"end"}}},c5:{text:[g("something's causing a commotion a ways down the road."),g("a fight, maybe.")],buttons:{continue:{text:g("continue"),nextScene:{1:"d2"}},leave:{text:g("leave town"),nextScene:"end"}}},c6:{text:[g("a small basket of food is hidden under a park bench, with a note attached."),g("can't read the words.")],loot:{cured_meat:{min:1,max:5,chance:1}},buttons:{continue:{text:g("continue"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:{1:"d2"}},leave:{text:g("leave town"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:"end"}}},d1:{combat:!0,enemy:"scavenger",chara:"E",damage:5,hit:.8,attackDelay:2,health:30,loot:{cured_meat:{min:1,max:5,chance:1},leather:{min:5,max:10,chance:.8},steel_sword:{min:1,max:1,chance:.5}},notification:g("a panicked scavenger bursts through the door, screaming."),buttons:{continue:{text:g("continue"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:{.5:"end1",1:"end2"}},leave:{text:g("leave town"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:"end"}}},d2:{combat:!0,enemy:"vigilante",chara:"D",damage:6,hit:.8,attackDelay:2,health:30,loot:{cured_meat:{min:1,max:5,chance:1},leather:{min:5,max:10,chance:.8},steel_sword:{min:1,max:1,chance:.5}},notification:g("a man stands over a dead wanderer. notices he's not alone."),buttons:{continue:{text:g("continue"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:{.5:"end3",1:"end4"}},leave:{text:g("leave town"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:"end"}}},end1:{text:[g("scavenger had a small camp in the school."),g("collected scraps spread across the floor like they fell from heaven.")],onLoad:function(e){e.spaces.World.clearDungeon()},loot:{steel_sword:{min:1,max:1,chance:1},steel:{min:5,max:10,chance:1},cured_meat:{min:5,max:10,chance:1},bolas:{min:1,max:5,chance:.5},medicine:{min:1,max:2,chance:.3}},buttons:{leave:{text:g("leave town"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:"end"}}},end2:{text:[g("scavenger'd been looking for supplies in here, it seems."),g("a shame to let what he'd found go to waste.")],onLoad:function(e){e.spaces.World.clearDungeon()},loot:{coal:{min:5,max:10,chance:1},cured_meat:{min:5,max:10,chance:1},leather:{min:5,max:10,chance:1}},buttons:{leave:{text:g("leave town"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:"end"}}},end3:{text:[g("beneath the wanderer's rags, clutched in one of its many hands, a glint of steel."),g("worth killing for, it seems.")],onLoad:function(e){e.spaces.World.clearDungeon()},loot:{rifle:{min:1,max:1,chance:1},bullets:{min:1,max:5,chance:1}},buttons:{leave:{text:g("leave town"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:"end"}}},end4:{text:[g("eye for an eye seems fair."),g("always worked before, at least."),g("picking the bones finds some useful trinkets.")],onLoad:function(e){e.spaces.World.clearDungeon()},loot:{cured_meat:{min:5,max:10,chance:1},iron:{min:5,max:10,chance:1},torch:{min:1,max:5,chance:1},bolas:{min:1,max:5,chance:.5},medicine:{min:1,max:2,chance:.1}},buttons:{leave:{text:g("leave town"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:"end"}}},end5:{text:[g("some medicine abandoned in the drawers.")],onLoad:function(e){e.spaces.World.clearDungeon()},loot:{medicine:{min:2,max:5,chance:1}},buttons:{leave:{text:g("leave town"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:"end"}}},end6:{text:[g("the clinic has been ransacked."),g("only dust and stains remain.")],onLoad:function(e){e.spaces.World.clearDungeon()},buttons:{leave:{text:g("leave town"),nextScene:"end"}}}}},city:{title:g("A Ruined City"),id:"city",scenes:{start:{text:[g("a battered highway sign stands guard at the entrance to this once-great city."),g("the towers that haven't crumbled jut from the landscape like the ribcage of some ancient beast."),g("might be things worth having still inside.")],notification:g("the towers of a decaying city dominate the skyline"),buttons:{enter:{text:g("explore"),nextScene:{.2:"a1",.5:"a2",.8:"a3",1:"a4"}},leave:{text:g("leave"),nextScene:"end"}}},a1:{text:[g("the streets are empty."),g("the air is filled with dust, driven relentlessly by the hard winds.")],buttons:{continue:{text:g("continue"),nextScene:{.5:"b1",1:"b2"}},leave:{text:g("leave city"),nextScene:"end"}}},a2:{text:[g("orange traffic cones are set across the street, faded and cracked."),g("lights flash through the alleys between buildings.")],buttons:{continue:{text:g("continue"),nextScene:{.5:"b3",1:"b4"}},leave:{text:g("leave city"),nextScene:"end"}}},a3:{text:[g("a large shanty town sprawls across the streets."),g("faces, darkened by soot and blood, stare out from crooked huts.")],buttons:{continue:{text:g("continue"),nextScene:{.5:"b5",1:"b6"}},leave:{text:g("leave city"),nextScene:"end"}}},a4:{text:[g("the shell of an abandoned hospital looms ahead.")],buttons:{enter:{text:g("enter"),cost:{torch:1},nextScene:{.5:"b7",1:"b8"}},leave:{text:g("leave city"),nextScene:"end"}}},b1:{text:[g("the old tower seems mostly intact."),g("the shell of a burned out car blocks the entrance."),g("most of the windows at ground level are busted anyway.")],buttons:{enter:{text:g("enter"),nextScene:{.5:"c1",1:"c2"}},leave:{text:g("leave city"),nextScene:"end"}}},b2:{combat:!0,notification:g("a huge lizard scrambles up out of the darkness of an old metro station."),enemy:"lizard",chara:"R",damage:5,hit:.8,attackDelay:2,health:20,loot:{scales:{min:5,max:10,chance:.8},teeth:{min:5,max:10,chance:.5},meat:{min:5,max:10,chance:.8}},buttons:{descend:{text:g("descend"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:{.5:"c2",1:"c3"}},leave:{text:g("leave city"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:"end"}}},b3:{notification:g("the shot echoes in the empty street."),combat:!0,enemy:"sniper",chara:"D",damage:15,hit:.8,attackDelay:4,health:30,ranged:!0,loot:{cured_meat:{min:1,max:5,chance:.8},bullets:{min:1,max:5,chance:.5},rifle:{min:1,max:1,chance:.2}},buttons:{continue:{text:g("continue"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:{.5:"c4",1:"c5"}},leave:{text:g("leave city"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:"end"}}},b4:{notification:g("the soldier steps out from between the buildings, rifle raised."),combat:!0,enemy:"soldier",ranged:!0,chara:"D",damage:8,hit:.8,attackDelay:2,health:50,loot:{cured_meat:{min:1,max:5,chance:.8},bullets:{min:1,max:5,chance:.5},rifle:{min:1,max:1,chance:.2}},buttons:{continue:{text:g("continue"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:{.5:"c5",1:"c6"}},leave:{text:g("leave city"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:"end"}}},b5:{notification:g("a frail man stands defiantly, blocking the path."),combat:!0,enemy:"frail man",chara:"E",damage:1,hit:.8,attackDelay:2,health:10,loot:{cured_meat:{min:1,max:5,chance:.8},cloth:{min:1,max:5,chance:.5},leather:{min:1,max:1,chance:.2},medicine:{min:1,max:3,chance:.05}},buttons:{continue:{text:g("continue"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:{.5:"c7",1:"c8"}},leave:{text:g("leave city"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:"end"}}},b6:{text:[g("nothing but downcast eyes."),g("the people here were broken a long time ago.")],buttons:{continue:{text:g("continue"),nextScene:{.5:"c8",1:"c9"}},leave:{text:g("leave city"),nextScene:"end"}}},b7:{text:[g("empty corridors."),g("the place has been swept clean by scavengers.")],buttons:{continue:{text:g("continue"),nextScene:{.3:"c12",.7:"c10",1:"c11"}},leave:{text:g("leave city"),nextScene:"end"}}},b8:{notification:g("an old man bursts through a door, wielding a scalpel."),combat:!0,enemy:"old man",chara:"E",damage:3,hit:.5,attackDelay:2,health:10,loot:{cured_meat:{min:1,max:3,chance:.5},cloth:{min:1,max:5,chance:.8},medicine:{min:1,max:2,chance:.5}},buttons:{continue:{text:g("continue"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:{.3:"c13",.7:"c11",1:"end15"}},leave:{text:g("leave city"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:"end"}}},c1:{notification:g("a thug is waiting on the other side of the wall."),combat:!0,enemy:"thug",chara:"E",damage:3,hit:.8,attackDelay:2,health:30,loot:{steel_sword:{min:1,max:1,chance:.5},cured_meat:{min:1,max:3,chance:.5},cloth:{min:1,max:5,chance:.8}},buttons:{continue:{text:g("continue"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:{.5:"d1",1:"d2"}},leave:{text:g("leave city"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:"end"}}},c2:{notification:g("a snarling beast jumps out from behind a car."),combat:!0,enemy:"beast",chara:"R",damage:2,hit:.8,attackDelay:1,health:30,loot:{meat:{min:1,max:5,chance:.8},fur:{min:1,max:5,chance:.8},teeth:{min:1,max:5,chance:.5}},buttons:{continue:{text:g("continue"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:{1:"d2"}},leave:{text:g("leave city"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:"end"}}},c3:{text:[g("street above the subway platform is blown away."),g("lets some light down into the dusty haze."),g("a sound comes from the tunnel, just ahead.")],buttons:{enter:{text:g("investigate"),cost:{torch:1},nextScene:{.5:"d2",1:"d3"}},leave:{text:g("leave city"),nextScene:"end"}}},c4:{text:[g("looks like a camp of sorts up ahead."),g("rusted chainlink is pulled across an alleyway."),g("fires burn in the courtyard beyond.")],buttons:{enter:{text:g("continue"),nextScene:{.5:"d4",1:"d5"}},leave:{text:g("leave city"),nextScene:"end"}}},c5:{text:[g("more voices can be heard ahead."),g("they must be here for a reason.")],buttons:{enter:{text:g("continue"),nextScene:{1:"d5"}},leave:{text:g("leave city"),nextScene:"end"}}},c6:{text:[g("the sound of gunfire carries on the wind."),g("the street ahead glows with firelight.")],buttons:{enter:{text:g("continue"),nextScene:{.5:"d5",1:"d6"}},leave:{text:g("leave city"),nextScene:"end"}}},c7:{text:[g("more squatters are crowding around now."),g("someone throws a stone.")],buttons:{enter:{text:g("continue"),nextScene:{.5:"d7",1:"d8"}},leave:{text:g("leave city"),nextScene:"end"}}},c8:{text:[g("an improvised shop is set up on the sidewalk."),g("the owner stands by, stoic.")],loot:{steel_sword:{min:1,max:1,chance:.8},rifle:{min:1,max:1,chance:.5},bullets:{min:1,max:8,chance:.25},alien_alloy:{min:1,max:1,chance:.01},medicine:{min:1,max:4,chance:.5}},buttons:{enter:{text:g("continue"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:{1:"d8"}},leave:{text:g("leave city"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:"end"}}},c9:{text:[g("strips of meat hang drying by the side of the street."),g("the people back away, avoiding eye contact.")],loot:{cured_meat:{min:5,max:10,chance:1}},buttons:{enter:{text:g("continue"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:{.5:"d8",1:"d9"}},leave:{text:g("leave city"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:"end"}}},c10:{text:[g("someone has locked and barricaded the door to this operating theatre.")],buttons:{enter:{text:g("continue"),nextScene:{.2:"end12",.6:"d10",1:"d11"}},leave:{text:g("leave city"),nextScene:"end"}}},c11:{notification:g("a tribe of elderly squatters is camped out in this ward."),combat:!0,enemy:"squatters",plural:!0,chara:"EEE",damage:2,hit:.7,attackDelay:.5,health:40,loot:{cured_meat:{min:1,max:3,chance:.5},cloth:{min:3,max:8,chance:.8},medicine:{min:1,max:3,chance:.3}},buttons:{continue:{text:g("continue"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:{1:"end10"}},leave:{text:g("leave city"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:"end"}}},c12:{notification:g("a pack of lizards rounds the corner."),combat:!0,enemy:"lizards",plural:!0,chara:"RRR",damage:4,hit:.7,attackDelay:.7,health:30,loot:{meat:{min:3,max:8,chance:1},teeth:{min:2,max:4,chance:1},scales:{min:3,max:5,chance:1}},buttons:{continue:{text:g("continue"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:{1:"end10"}},leave:{text:g("leave city"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:"end"}}},c13:{text:[g("strips of meat are hung up to dry in this ward.")],loot:{cured_meat:{min:3,max:10,chance:1}},buttons:{continue:{text:g("continue"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:{.5:"end10",1:"end11"}},leave:{text:g("leave city"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:"end"}}},d1:{notification:g("a large bird nests at the top of the stairs."),combat:!0,enemy:"bird",chara:"R",damage:5,hit:.7,attackDelay:1,health:45,loot:{meat:{min:5,max:10,chance:.8}},buttons:{continue:{text:g("continue"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:{.5:"end1",1:"end2"}},leave:{text:g("leave city"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:"end"}}},d2:{text:[g("the debris is denser here."),g("maybe some useful stuff in the rubble.")],loot:{bullets:{min:1,max:5,chance:.5},steel:{min:1,max:10,chance:.8},alien_alloy:{min:1,max:1,chance:.01},cloth:{min:1,max:10,chance:1}},buttons:{continue:{text:g("continue"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:{1:"end2"}},leave:{text:g("leave city"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:"end"}}},d3:{notification:g("a swarm of rats rushes up the tunnel."),combat:!0,enemy:"rats",plural:!0,chara:"RRR",damage:1,hit:.8,attackDelay:.25,health:60,loot:{fur:{min:5,max:10,chance:.8},teeth:{min:5,max:10,chance:.5}},buttons:{continue:{text:g("continue"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:{.5:"end2",1:"end3"}},leave:{text:g("leave city"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:"end"}}},d4:{notification:g("a large man attacks, waving a bayonet."),combat:!0,enemy:"veteran",chara:"D",damage:6,hit:.8,attackDelay:2,health:45,loot:{bayonet:{min:1,max:1,chance:.5},cured_meat:{min:1,max:5,chance:.8}},buttons:{continue:{text:g("continue"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:{.5:"end4",1:"end5"}},leave:{text:g("leave city"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:"end"}}},d5:{notification:g("a second soldier opens fire."),combat:!0,enemy:"soldier",ranged:!0,chara:"D",damage:8,hit:.8,attackDelay:2,health:50,loot:{cured_meat:{min:1,max:5,chance:.8},bullets:{min:1,max:5,chance:.5},rifle:{min:1,max:1,chance:.2}},buttons:{continue:{text:g("continue"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:{1:"end5"}},leave:{text:g("leave city"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:"end"}}},d6:{notification:g("a masked soldier rounds the corner, gun drawn"),combat:!0,enemy:"commando",chara:"D",ranged:!0,damage:3,hit:.9,attackDelay:2,health:55,loot:{rifle:{min:1,max:1,chance:.5},bullets:{min:1,max:5,chance:.8},cured_meat:{min:1,max:5,chance:.8}},buttons:{continue:{text:g("continue"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:{.5:"end5",1:"end6"}},leave:{text:g("leave city"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:"end"}}},d7:{notification:g("the crowd surges forward."),combat:!0,enemy:"squatters",plural:!0,chara:"EEE",damage:2,hit:.7,attackDelay:.5,health:40,loot:{cloth:{min:1,max:5,chance:.8},teeth:{min:1,max:5,chance:.5}},buttons:{continue:{text:g("continue"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:{.5:"end7",1:"end8"}},leave:{text:g("leave city"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:"end"}}},d8:{notification:g("a youth lashes out with a tree branch."),combat:!0,enemy:"youth",chara:"E",damage:2,hit:.7,attackDelay:1,health:45,loot:{cloth:{min:1,max:5,chance:.8},teeth:{min:1,max:5,chance:.5}},buttons:{continue:{text:g("continue"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:{1:"end8"}},leave:{text:g("leave city"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:"end"}}},d9:{notification:g("a squatter stands firmly in the doorway of a small hut."),combat:!0,enemy:"squatter",chara:"E",damage:3,hit:.8,attackDelay:2,health:20,loot:{cloth:{min:1,max:5,chance:.8},teeth:{min:1,max:5,chance:.5}},buttons:{continue:{text:g("continue"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:{.5:"end8",1:"end9"}},leave:{text:g("leave city"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:"end"}}},d10:{notification:g("behind the door, a deformed figure awakes and attacks."),combat:!0,enemy:"deformed",chara:"T",damage:8,hit:.6,attackDelay:2,health:40,loot:{cloth:{min:1,max:5,chance:.8},teeth:{min:2,max:2,chance:1},steel:{min:1,max:3,chance:.6},scales:{min:2,max:3,chance:.1}},buttons:{continue:{text:g("continue"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:{1:"end14"}}}},d11:{notification:g("as soon as the door is open a little bit, hundreds of tentacles erupt."),combat:!0,enemy:"tentacles",plural:!0,chara:"TTT",damage:2,hit:.6,attackDelay:.5,health:60,loot:{meat:{min:10,max:20,chance:1}},buttons:{continue:{text:g("continue"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:{1:"end13"}}}},end1:{text:[g("bird must have liked shiney things."),g("some good stuff woven into its nest.")],onLoad:function(e){e.spaces.World.clearDungeon(),e.dispatch(e.actions.game.city.setM({cleared:!0}))},loot:{bullets:{min:5,max:10,chance:.8},bolas:{min:1,max:5,chance:.5},alien_alloy:{min:1,max:1,chance:.5}},buttons:{leave:{text:g("leave city"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:"end"}}},end2:{text:[g("not much here."),g("scavengers must have gotten to this place already.")],onLoad:function(e){e.spaces.World.clearDungeon(),e.dispatch(e.actions.game.city.setM({cleared:!0}))},loot:{torch:{min:1,max:5,chance:.8},cured_meat:{min:1,max:5,chance:.5}},buttons:{leave:{text:g("leave city"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:"end"}}},end3:{text:[g("the tunnel opens up at another platform."),g("the walls are scorched from an old battle."),g("bodies and supplies from both sides litter the ground.")],onLoad:function(e){e.spaces.World.clearDungeon(),e.dispatch(e.actions.game.city.setM({cleared:!0}))},loot:{rifle:{min:1,max:1,chance:.8},bullets:{min:1,max:5,chance:.8},laser_rifle:{min:1,max:1,chance:.3},energy_cell:{min:1,max:5,chance:.3},alien_alloy:{min:1,max:1,chance:.3}},buttons:{leave:{text:g("leave city"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:"end"}}},end4:{text:[g("the small military outpost is well supplied."),g("arms and munitions, relics from the war, are neatly arranged on the store-room floor."),g("just as deadly now as they were then.")],onLoad:function(e){e.spaces.World.clearDungeon(),e.dispatch(e.actions.game.city.setM({cleared:!0}))},loot:{rifle:{min:1,max:1,chance:1},bullets:{min:1,max:10,chance:1},grenade:{min:1,max:5,chance:.8}},buttons:{leave:{text:g("leave city"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:"end"}}},end5:{text:[g("searching the bodies yields a few supplies."),g("more soldiers will be on their way."),g("time to move on.")],onLoad:function(e){e.spaces.World.clearDungeon(),e.dispatch(e.actions.game.city.setM({cleared:!0}))},loot:{rifle:{min:1,max:1,chance:1},bullets:{min:1,max:10,chance:1},cured_meat:{min:1,max:5,chance:.8},medicine:{min:1,max:4,chance:.1}},buttons:{leave:{text:g("leave city"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:"end"}}},end6:{text:[g("the small settlement has clearly been burning a while."),g("the bodies of the wanderers that lived here are still visible in the flames."),g("still time to rescue a few supplies.")],onLoad:function(e){e.spaces.World.clearDungeon(),e.dispatch(e.actions.game.city.setM({cleared:!0}))},loot:{laser_rifle:{min:1,max:1,chance:.5},energy_cell:{min:1,max:5,chance:.5},cured_meat:{min:1,max:10,chance:1}},buttons:{leave:{text:g("leave city"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:"end"}}},end7:{text:[g("the remaining settlers flee from the violence, their belongings forgotten."),g("there's not much, but some useful things can still be found.")],onLoad:function(e){e.spaces.World.clearDungeon(),e.dispatch(e.actions.game.city.setM({cleared:!0}))},loot:{steel_sword:{min:1,max:1,chance:.8},energy_cell:{min:1,max:5,chance:.5},cured_meat:{min:1,max:10,chance:1}},buttons:{leave:{text:g("leave city"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:"end"}}},end8:{text:[g("the young settler was carrying a canvas sack."),g("it contains travelling gear, and a few trinkets."),g("there's nothing else here.")],onLoad:function(e){e.spaces.World.clearDungeon(),e.dispatch(e.actions.game.city.setM({cleared:!0}))},loot:{steel_sword:{min:1,max:1,chance:.8},bolas:{min:1,max:5,chance:.5},cured_meat:{min:1,max:10,chance:1}},buttons:{leave:{text:g("leave city"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:"end"}}},end9:{text:[g("inside the hut, a child cries."),g("a few belongings rest against the walls."),g("there's nothing else here.")],onLoad:function(e){e.spaces.World.clearDungeon(),e.dispatch(e.actions.game.city.setM({cleared:!0}))},loot:{rifle:{min:1,max:1,chance:.8},bullets:{min:1,max:5,chance:.8},bolas:{min:1,max:5,chance:.5},alien_alloy:{min:1,max:1,chance:.2}},buttons:{leave:{text:g("leave city"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:"end"}}},end10:{text:[g("the stench of rot and death fills the operating theatres."),g("a few items are scattered on the ground."),g("there is nothing else here.")],onLoad:function(e){e.spaces.World.clearDungeon(),e.dispatch(e.actions.game.city.setM({cleared:!0}))},loot:{energy_cell:{min:1,max:1,chance:.3},medicine:{min:1,max:5,chance:.3},teeth:{min:3,max:8,chance:1},scales:{min:4,max:7,chance:.9}},buttons:{leave:{text:g("leave city"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:"end"}}},end11:{text:[g("a pristine medicine cabinet at the end of a hallway."),g("the rest of the hospital is empty.")],onLoad:function(e){e.spaces.World.clearDungeon(),e.dispatch(e.actions.game.city.setM({cleared:!0}))},loot:{energy_cell:{min:1,max:1,chance:.2},medicine:{min:3,max:10,chance:1},teeth:{min:1,max:2,chance:.2}},buttons:{leave:{text:g("leave city"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:"end"}}},end12:{text:[g("someone had been stockpiling loot here.")],onLoad:function(e){e.spaces.World.clearDungeon(),e.dispatch(e.actions.game.city.setM({cleared:!0}))},loot:{energy_cell:{min:1,max:3,chance:.2},medicine:{min:3,max:10,chance:.5},bullets:{min:2,max:8,chance:1},torch:{min:1,max:3,chance:.5},grenade:{min:1,max:1,chance:.5},alien_alloy:{min:1,max:2,chance:.8}},buttons:{leave:{text:g("leave city"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:"end"}}},end13:{text:[g("the tentacular horror is defeated."),g("inside, the remains of its victims are everywhere.")],onLoad:function(e){e.spaces.World.clearDungeon(),e.dispatch(e.actions.game.city.setM({cleared:!0}))},loot:{steel_sword:{min:1,max:3,chance:.5},rifle:{min:1,max:2,chance:.3},teeth:{min:2,max:8,chance:1},cloth:{min:3,max:6,chance:.5},alien_alloy:{min:1,max:1,chance:.1}},buttons:{leave:{text:g("leave city"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:"end"}}},end14:{text:[g("the warped man lies dead."),g("the operating theatre has a lot of curious equipment.")],onLoad:function(e){e.spaces.World.clearDungeon(),e.dispatch(e.actions.game.city.setM({cleared:!0}))},loot:{energy_cell:{min:2,max:5,chance:.8},medicine:{min:3,max:12,chance:1},cloth:{min:1,max:3,chance:.5},steel:{min:2,max:3,chance:.3},alien_alloy:{min:1,max:1,chance:.3}},buttons:{leave:{text:g("leave city"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:"end"}}},end15:{text:[g("the old man had a small cache of interesting items.")],onLoad:function(e){e.spaces.World.clearDungeon(),e.dispatch(e.actions.game.city.setM({cleared:!0}))},loot:{alien_alloy:{min:1,max:1,chance:.8},medicine:{min:1,max:4,chance:1},cured_meat:{min:3,max:7,chance:1},bolas:{min:1,max:3,chance:.5},fur:{min:1,max:5,chance:.8}},buttons:{leave:{text:g("leave city"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:"end"}}}}},house:{title:g("An Old House"),id:"house",scenes:{start:{text:[g("an old house remains here, once white siding yellowed and peeling."),g("the door hangs open.")],notification:g("the remains of an old house stand as a monument to simpler times"),buttons:{enter:{text:g("go inside"),nextScene:{.25:"medicine",.5:"supplies",1:"occupied"}},leave:{text:g("leave"),nextScene:"end"}}},supplies:{text:[g("the house is abandoned, but not yet picked over."),g("still a few drops of water in the old well.")],onLoad:function(e){var t=e.getState().game.world.curPos;e.spaces.World.markVisited(t[0],t[1]),e.spaces.World.setWater(e.spaces.World.getMaxWater()),e.notify("water replenished")},loot:{cured_meat:{min:1,max:10,chance:.8},leather:{min:1,max:10,chance:.2},cloth:{min:1,max:10,chance:.5}},buttons:{leave:{text:g("leave"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:"end"}}},medicine:{text:[g("the house has been ransacked."),g("but there is a cache of medicine under the floorboards.")],onLoad:function(e){var t=e.getState().game.world.curPos;e.spaces.World.markVisited(t[0],t[1])},loot:{medicine:{min:2,max:5,chance:1}},buttons:{leave:{text:g("leave"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:"end"}}},occupied:{combat:!0,enemy:"squatter",chara:"E",damage:3,hit:.8,attackDelay:2,health:10,notification:g("a man charges down the hall, a rusty blade in his hand"),onLoad:function(e){var t=e.getState().game.world.curPos;e.spaces.World.markVisited(t[0],t[1])},loot:{cured_meat:{min:1,max:10,chance:.8},leather:{min:1,max:10,chance:.2},cloth:{min:1,max:10,chance:.5}},buttons:{leave:{text:g("leave"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:"end"}}}}},battlefield:{title:g("A Forgotten Battlefield"),id:"battlefield",scenes:{start:{text:[g("a battle was fought here, long ago."),g("battered technology from both sides lays dormant on the blasted landscape.")],onLoad:function(e){var t=e.getState().game.world.curPos;e.spaces.World.markVisited(t[0],t[1])},loot:{rifle:{min:1,max:3,chance:.5},bullets:{min:5,max:20,chance:.8},laser_rifle:{min:1,max:3,chance:.3},energy_cell:{min:5,max:10,chance:.5},grenade:{min:1,max:5,chance:.5},alien_alloy:{min:1,max:1,chance:.3}},buttons:{leave:{text:g("leave"),nextScene:"end"}}}}},borehole:{title:g("A Huge Borehole"),id:"borehole",scenes:{start:{text:[g("a huge hole is cut deep into the earth, evidence of the past harvest."),g("they took what they came for, and left."),g("castoff from the mammoth drills can still be found by the edges of the precipice.")],onLoad:function(e){var t=e.getState().game.world.curPos;e.spaces.World.markVisited(t[0],t[1])},loot:{alien_alloy:{min:1,max:3,chance:1}},buttons:{leave:{text:g("leave"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:"end"}}}}},ship:{title:g("A Crashed Ship"),id:"ship",scenes:{start:{onLoad:function(){var e=o(p.mark((function e(t){var n,a;return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.getState(),a=n.game.world.curPos,e.next=4,t.spaces.World.markVisited(a[0],a[1]);case 4:return e.next=6,t.spaces.World.drawRoad();case 6:return e.next=8,t.dispatch(t.actions.features.location.enableSpaceShip());case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),text:[g("the familiar curves of a wanderer vessel rise up out of the dust and ash. "),g("lucky that the natives can't work the mechanisms."),g("with a little effort, it might fly again.")],buttons:{leavel:{text:g("salvage"),nextScene:"end"}}}}},sulphurmine:{title:g("The Sulphur Mine"),id:"sulphurmine",scenes:{start:{text:[g("the military is already set up at the mine's entrance."),g("soldiers patrol the perimeter, rifles slung over their shoulders.")],notification:g("a military perimeter is set up around the mine."),buttons:{attack:{text:g("attack"),nextScene:{1:"a1"}},leave:{text:g("leave"),nextScene:"end"}}},a1:{combat:!0,enemy:"soldier",ranged:!0,chara:"D",damage:8,hit:.8,attackDelay:2,health:50,loot:{cured_meat:{min:1,max:5,chance:.8},bullets:{min:1,max:5,chance:.5},rifle:{min:1,max:1,chance:.2}},notification:g("a soldier, alerted, opens fire."),buttons:{continue:{text:g("continue"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:{1:"a2"}},run:{text:g("run"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:"end"}}},a2:{combat:!0,enemy:"soldier",ranged:!0,chara:"D",damage:8,hit:.8,attackDelay:2,health:50,loot:{cured_meat:{min:1,max:5,chance:.8},bullets:{min:1,max:5,chance:.5},rifle:{min:1,max:1,chance:.2}},notification:g("a second soldier joins the fight."),buttons:{continue:{text:g("continue"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:{1:"a3"}},run:{text:g("run"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:"end"}}},a3:{combat:!0,enemy:"veteran",chara:"D",damage:10,hit:.8,attackDelay:2,health:65,loot:{bayonet:{min:1,max:1,chance:.5},cured_meat:{min:1,max:5,chance:.8}},notification:g("a grizzled soldier attacks, waving a bayonet."),buttons:{continue:{text:g("continue"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:{1:"cleared"}}}},cleared:{text:[g("the military presence has been cleared."),g("the mine is now safe for workers.")],notification:g("the sulphur mine is clear of dangers"),onLoad:function(){var e=o(p.mark((function e(t){var n,a;return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.getState(),a=n.game.world.curPos,e.next=4,t.spaces.World.drawRoad();case 4:return e.next=6,t.dispatch(t.actions.game.world.setM({sulphurmine:!0}));case 6:return e.next=8,t.spaces.World.markVisited(a[0],a[1]);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),buttons:{leave:{text:g("leave"),nextScene:"end"}}}}},coalmine:{title:g("The Coal Mine"),id:"coalmine",scenes:{start:{text:[g("camp fires burn by the entrance to the mine."),g("men mill about, weapons at the ready.")],notification:g("this old mine is not abandoned"),buttons:{attack:{text:g("attack"),nextScene:{1:"a1"}},leave:{text:g("leave"),nextScene:"end"}}},a1:{combat:!0,enemy:"man",chara:"E",damage:3,hit:.8,attackDelay:2,health:10,loot:{cured_meat:{min:1,max:5,chance:.8},cloth:{min:1,max:5,chance:.8}},notification:g("a man joins the fight"),buttons:{continue:{text:g("continue"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:{1:"a2"}},run:{text:g("run"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:"end"}}},a2:{combat:!0,enemy:"man",chara:"E",damage:3,hit:.8,attackDelay:2,health:10,loot:{cured_meat:{min:1,max:5,chance:.8},cloth:{min:1,max:5,chance:.8}},notification:g("a man joins the fight"),buttons:{continue:{text:g("continue"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:{1:"a3"}},run:{text:g("run"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:"end"}}},a3:{combat:!0,enemy:"chief",chara:"D",damage:5,hit:.8,attackDelay:2,health:20,loot:{cured_meat:{min:5,max:10,chance:1},cloth:{min:5,max:10,chance:.8},iron:{min:1,max:5,chance:.8}},notification:g("only the chief remains."),buttons:{continue:{text:g("continue"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:{1:"cleared"}}}},cleared:{text:[g("the camp is still, save for the crackling of the fires."),g("the mine is now safe for workers.")],notification:g("the coal mine is clear of dangers"),onLoad:function(){var e=o(p.mark((function e(t){var n,a;return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.getState(),a=n.game.world.curPos,e.next=4,t.spaces.World.drawRoad();case 4:return e.next=6,t.dispatch(t.actions.game.world.setM({coalmine:!0}));case 6:return e.next=8,t.spaces.World.markVisited(a[0],a[1]);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),buttons:{leave:{text:g("leave"),nextScene:"end"}}}}},ironmine:{title:g("The Iron Mine"),id:"ironmine",scenes:{start:{text:[g("an old iron mine sits here, tools abandoned and left to rust."),g("bleached bones are strewn about the entrance. many, deeply scored with jagged grooves."),g("feral howls echo out of the darkness.")],notification:g("the path leads to an abandoned mine"),buttons:{enter:{text:g("go inside"),nextScene:{1:"enter"},cost:{torch:1}},leave:{text:g("leave"),nextScene:"end"}}},enter:{combat:!0,enemy:"beastly matriarch",chara:"T",damage:4,hit:.8,attackDelay:2,health:10,loot:{teeth:{min:5,max:10,chance:1},scales:{min:5,max:10,chance:.8},cloth:{min:5,max:10,chance:.5}},notification:g("a large creature lunges, muscles rippling in the torchlight"),buttons:{leave:{text:g("leave"),cooldown:X.Event.LEAVE_COOLDOWN,nextScene:{1:"cleared"}}}},cleared:{text:[g("the beast is dead."),g("the mine is now safe for workers.")],notification:g("the iron mine is clear of dangers"),onLoad:function(){var e=o(p.mark((function e(t){var n,a;return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.getState(),a=n.game.world.curPos,e.next=4,t.spaces.World.drawRoad();case 4:return e.next=6,t.dispatch(t.actions.game.world.setM({ironmine:!0}));case 6:return e.next=8,t.spaces.World.markVisited(a[0],a[1]);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),buttons:{leave:{text:g("leave"),nextScene:"end"}}}}},cache:{title:g("A Destroyed Village"),id:"cache",scenes:{start:{text:[g("a destroyed village lies in the dust."),g("charred bodies litter the ground.")],notification:g("the metallic tang of wanderer afterburner hangs in the air."),buttons:{enter:{text:g("enter"),nextScene:{1:"underground"}},leave:{text:g("leave"),nextScene:"end"}}},underground:{text:[g("a shack stands at the center of the village."),g("there are still supplies inside.")],buttons:{take:{text:g("take"),nextScene:{1:"exit"}}}},exit:{text:[g("all the work of a previous generation is here."),g("ripe for the picking.")],onLoad:function(e){var t=e.getState().game.world.curPos;e.spaces.World.markVisited(t[0],t[1]),e.prestige.collectStores()},buttons:{leave:{text:g("leave"),nextScene:"end"}}}}}},$t=[{title:g("A Snarling Beast"),isAvailable:function(e,t){return t.spaces.World.getDistance()<=10&&t.spaces.World.getTerrain()===X.World.TILE.FOREST},scenes:{start:{combat:!0,enemy:"snarling beast",enemyName:g("snarling beast"),deathMessage:g("the snarling beast is dead"),chara:"R",damage:1,hit:.8,attackDelay:1,health:5,loot:{fur:{min:1,max:3,chance:1},meat:{min:1,max:3,chance:1},teeth:{min:1,max:3,chance:.8}},notification:g("a snarling beast leaps out of the underbrush")}}},{title:g("A Gaunt Man"),isAvailable:function(e,t){return t.spaces.World.getDistance()<=10&&t.spaces.World.getTerrain()===X.World.TILE.BARRENS},scenes:{start:{combat:!0,enemy:"gaunt man",enemyName:g("gaunt man"),deathMessage:g("the gaunt man is dead"),chara:"E",damage:2,hit:.8,attackDelay:2,health:6,loot:{cloth:{min:1,max:3,chance:.8},teeth:{min:1,max:2,chance:.8},leather:{min:1,max:2,chance:.5}},notification:g("a gaunt man approaches, a crazed look in his eye")}}},{title:g("A Strange Bird"),isAvailable:function(e,t){return t.spaces.World.getDistance()<=10&&t.spaces.World.getTerrain()===X.World.TILE.FIELD},scenes:{start:{combat:!0,enemy:"strange bird",enemyName:g("strange bird"),deathMessage:g("the strange bird is dead"),chara:"R",damage:3,hit:.8,attackDelay:2,health:4,loot:{scales:{min:1,max:3,chance:.8},teeth:{min:1,max:2,chance:.5},meat:{min:1,max:3,chance:.8}},notification:g("a strange looking bird speeds across the plains")}}},{title:g("A Shivering Man"),isAvailable:function(e,t){var n=t.spaces.World.getDistance();return n>10&&n<=20&&t.spaces.World.getTerrain()===X.World.TILE.BARRENS},scenes:{start:{combat:!0,enemy:"shivering man",enemyName:g("shivering man"),deathMessage:g("the shivering man is dead"),chara:"E",damage:5,hit:.5,attackDelay:1,health:20,loot:{cloth:{min:1,max:1,chance:.2},teeth:{min:1,max:2,chance:.8},leather:{min:1,max:1,chance:.2},medicine:{min:1,max:3,chance:.7}},notification:g("a shivering man approaches and attacks with surprising strength")}}},{title:g("A Man-Eater"),isAvailable:function(e,t){var n=t.spaces.World.getDistance();return n>10&&n<=20&&t.spaces.World.getTerrain()===X.World.TILE.FOREST},scenes:{start:{combat:!0,enemy:"man-eater",enemyName:g("man-eater"),deathMessage:g("the man-eater is dead"),chara:"T",damage:3,hit:.8,attackDelay:1,health:25,loot:{fur:{min:5,max:10,chance:1},meat:{min:5,max:10,chance:1},teeth:{min:5,max:10,chance:.8}},notification:g("a large creature attacks, claws freshly bloodied")}}},{title:g("A Scavenger"),isAvailable:function(e,t){var n=t.spaces.World.getDistance();return n>10&&n<=20&&t.spaces.World.getTerrain()===X.World.TILE.BARRENS},scenes:{start:{combat:!0,enemy:"scavenger",enemyName:g("scavenger"),deathMessage:g("the scavenger is dead"),chara:"E",damage:4,hit:.8,attackDelay:2,health:30,loot:{cloth:{min:5,max:10,chance:.8},leather:{min:5,max:10,chance:.8},iron:{min:1,max:5,chance:.5},medicine:{min:1,max:2,chance:.1}},notification:g("a scavenger draws close, hoping for an easy score")}}},{title:g("A Huge Lizard"),isAvailable:function(e,t){var n=t.spaces.World.getDistance();return n>10&&n<=20&&t.spaces.World.getTerrain()===X.World.TILE.FIELD},scenes:{start:{combat:!0,enemy:"lizard",enemyName:g("lizard"),deathMessage:g("the lizard is dead"),chara:"T",damage:5,hit:.8,attackDelay:2,health:20,loot:{scales:{min:5,max:10,chance:.8},teeth:{min:5,max:10,chance:.5},meat:{min:5,max:10,chance:.8}},notification:g("the grass thrashes wildly as a huge lizard pushes through")}}},{title:g("A Feral Terror"),isAvailable:function(e,t){return t.spaces.World.getDistance()>20&&t.spaces.World.getTerrain()===X.World.TILE.FOREST},scenes:{start:{combat:!0,enemy:"feral terror",enemyName:g("feral terror"),deathMessage:g("the feral terror is dead"),chara:"T",damage:6,hit:.8,attackDelay:1,health:45,loot:{fur:{min:5,max:10,chance:1},meat:{min:5,max:10,chance:1},teeth:{min:5,max:10,chance:.8}},notification:g("a beast, wilder than imagining, erupts out of the foliage")}}},{title:g("A Soldier"),isAvailable:function(e,t){return t.spaces.World.getDistance()>20&&t.spaces.World.getTerrain()===X.World.TILE.BARRENS},scenes:{start:{combat:!0,enemy:"soldier",enemyName:g("soldier"),deathMessage:g("the soldier is dead"),ranged:!0,chara:"D",damage:8,hit:.8,attackDelay:2,health:50,loot:{cloth:{min:5,max:10,chance:.8},bullets:{min:1,max:5,chance:.5},rifle:{min:1,max:1,chance:.2},medicine:{min:1,max:2,chance:.1}},notification:g("a soldier opens fire from across the desert")}}},{title:g("A Sniper"),isAvailable:function(e,t){return t.spaces.World.getDistance()>20&&t.spaces.World.getTerrain()===X.World.TILE.FIELD},scenes:{start:{combat:!0,enemy:"sniper",enemyName:g("sniper"),deathMessage:g("the sniper is dead"),chara:"D",damage:15,hit:.8,attackDelay:4,health:30,ranged:!0,loot:{cloth:{min:5,max:10,chance:.8},bullets:{min:1,max:5,chance:.5},rifle:{min:1,max:1,chance:.2},medicine:{min:1,max:2,chance:.1}},notification:g("a shot rings out, from somewhere in the long grass")}}}],Xt=function(){function e(e){this.engine=e}var t=e.prototype;return t.onArrival=function(){},t.clean=function(){},e}(),Jt=function(){function e(e,t){this.engine=e,this.manager=t,this.listeners={}}var t=e.prototype;return t.clearCooldown=function(){var e=o(p.mark((function e(t){var n;return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=this.manager.findById(t))){e.next=4;break}return e.next=4,this.engine.dispatch(this.engine.actions.operation.clearCooldown(n.id));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),t.cooldown=function(){var e=o(p.mark((function e(t){var n;return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=this.manager.findById(t))){e.next=4;break}return e.next=4,this.engine.dispatch(this.engine.actions.operation.record(n));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),t.availableOperations=function(){var e=this,t=[],n=this.engine.getState();return this.manager.operations.forEach((function(a){if(!a.isAvailable||a.isAvailable(e.engine,a)){var r={name:a.name,id:a.id};a.desc&&(r.desc=a.desc),a.help&&(r.help=a.help(e.engine,a)),r.history=n.operation[a.id],r.cooldown=a.cooldown?a.cooldown(e.engine,a):0,r.meta=a.meta,t.push(r)}})),t},t.on=function(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)},t.off=function(e,t){if(this.listeners[e]){var n=this.listeners[e].indexOf(t);n>-1&&this.listeners[e].splice(n,1)}},t.emit=function(e,t){(this.listeners[e]||[]).forEach((function(e){e(t)}))},t.exec=function(){var e=o(p.mark((function e(t){var n,a,r,o,i,s,c,l=arguments;return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.manager.findById(t),a=this.engine.getState(),!n){e.next=19;break}if(!(r=a.operation[t])||!n.cooldown){e.next=7;break}if(!(Date.now()<=r.cooldownAt)){e.next=7;break}return e.abrupt("return");case 7:if(!n.isAvailable||n.isAvailable(this.engine,n)){e.next=9;break}return e.abrupt("return");case 9:return e.next=11,this.engine.dispatch(this.engine.actions.operation.record(n));case 11:for(o=l.length,i=new Array(o>1?o-1:0),s=1;s<o;s++)i[s-1]=l[s];return Mt("operation "+t+" start",i),e.next=15,n.exec.apply(n,[this.engine,n].concat(i));case 15:return this.emit(t,c=e.sent),Mt("operation "+t+" finish",c),e.abrupt("return",c);case 19:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),e}(),Zt=new(function(){function e(){this.operations=[]}var t=e.prototype;return t.findById=function(e){return this.operations.find((function(t){return t.id===e}))},t.add=function(e){return this.findById(e.id)||(this.operations.push(e),e)},e}());Zt.add({id:"Combat.takeLoot",name:"take",isAvailable:function(e){var t=e.getState();return!n.isEmpty(t.events.loot)&&t.events.won&&t.engine.activeSpace===exports.GameSpace.World},meta:{space:exports.GameSpace.World},help:function(e){var t=e.getState(),n=[];return Object.keys(t.events.loot).forEach((function(e){t.events.loot[e]>0&&n.push(e)})),{desc:"take "+n.join(", "),parms:[n]}},exec:(Gt=o(p.mark((function e(t,n,a){var r,o,i,s,c,l;return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.getState(),o=t.spaces.Path,!(r.events.loot[a]>0)){e.next=12;break}if(i=o.getWeight(a),s=t.spaces.World.getFreeSpace(),!(i<=s)){e.next=11;break}return e.next=9,t.dispatch(t.actions.events.addM(((c={})["loot."+a]=-1,c)));case 9:return e.next=11,t.dispatch(t.actions.game.world.addM(((l={})["outfit."+a]=1,l)));case 11:return e.abrupt("return",!0);case 12:return e.abrupt("return",!1);case 13:case"end":return e.stop()}}),e)}))),function(e,t,n){return Gt.apply(this,arguments)})}),Zt.add({id:"Combat.takeAllLoot",name:"take all",isAvailable:function(e){var t=e.getState();return!n.isEmpty(t.events.loot)&&t.events.won&&t.engine.activeSpace===exports.GameSpace.World},meta:{space:exports.GameSpace.World},help:function(e){var t=e.getState(),n=[];return Object.keys(t.events.loot).forEach((function(e){t.events.loot[e]>0&&n.push(e)})),{desc:"take all "+n.join(", "),parms:[n]}},exec:(Pt=o(p.mark((function e(t,n,a){var r,o,i;return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.getState(),o=r.events.loot[a],i=0;case 3:if(!(i<o)){e.next=12;break}return e.next=6,t.operationExecutor.exec("Combat.takeLoot",a);case 6:if(e.sent){e.next=9;break}return e.abrupt("break",12);case 9:i++,e.next=3;break;case 12:return e.abrupt("return",[i===o,i]);case 13:case"end":return e.stop()}}),e)}))),function(e,t,n){return Pt.apply(this,arguments)})}),Zt.add({id:"Combat.takeEverything",name:"take everything",isAvailable:function(e){var t=e.getState();return!n.isEmpty(t.events.loot)&&t.events.won&&t.engine.activeSpace===exports.GameSpace.World},meta:{space:exports.GameSpace.World},exec:(It=o(p.mark((function e(t){var n,a,r,o,i;return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.getState(),a={},r=!0,e.t0=p.keys(n.events.loot);case 5:if((e.t1=e.t0()).done){e.next=16;break}return o=e.t1.value,e.next=9,t.operationExecutor.exec("Combat.takeAllLoot",o);case 9:if(a[o]=(i=e.sent)[1],i[0]){e.next=14;break}return r=!1,e.abrupt("break",16);case 14:e.next=5;break;case 16:return e.abrupt("return",[r,a]);case 17:case"end":return e.stop()}}),e)}))),function(e){return It.apply(this,arguments)})}),Zt.add({id:"Combat.dropStuff",name:"drop stuff",isAvailable:function(e){var t=e.getState();return!n.isEmpty(t.game.world.outfit)&&t.events.won&&t.engine.activeSpace===exports.GameSpace.World},meta:{space:exports.GameSpace.World},help:function(e){var t=e.getState(),n=[];return Object.keys(t.game.world.outfit).forEach((function(e){t.events.loot[e]>0&&n.push(e)})),{desc:"drop "+n.join(", "),parms:[n]}},exec:(Vt=o(p.mark((function e(t,n,a){var r,o,i,s;return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.getState(),!((o=Math.min(r.game.world.outfit[a],1))>0)){e.next=9;break}return e.next=7,t.dispatch(t.actions.events.addM(((i={})["loot."+a]=o,i)));case 7:return e.next=9,t.dispatch(t.actions.game.world.addM(((s={})["outfit."+a]=-o,s)));case 9:return e.abrupt("return",o);case 10:case"end":return e.stop()}}),e)}))),function(e,t,n){return Vt.apply(this,arguments)})}),Zt.add({id:"Combat.eatMeatInFight",name:"eat meat",cooldown:function(){return X.Event.EAT_COOLDOWN},isAvailable:function(e){var t=e.getState();return t.events.enemys.length>0&&!t.events.won&&t.engine.activeSpace===exports.GameSpace.World},meta:{space:exports.GameSpace.World,cost:(Ct={},Ct[exports.StoreCategory.cured_meat]=1,Ct)},exec:(Ft=o(p.mark((function e(t){return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.events.doHeal(exports.StoreCategory.cured_meat,t.spaces.World.meatHeal());case 2:e.sent||t.operationExecutor.clearCooldown("Combat.eatMeatInFight");case 4:case"end":return e.stop()}}),e)}))),function(e){return Ft.apply(this,arguments)})}),Zt.add({id:"Combat.eatMeat",name:"eat meat",isAvailable:function(e){var t=e.getState();return t.events.won&&t.engine.activeSpace===exports.GameSpace.World},meta:{space:exports.GameSpace.World,cost:(Rt={},Rt[exports.StoreCategory.cured_meat]=1,Rt)},exec:(Ht=o(p.mark((function e(t){return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.events.doHeal(exports.StoreCategory.cured_meat,t.spaces.World.meatHeal());case 2:e.sent||t.operationExecutor.clearCooldown("Combat.eatMeat");case 4:case"end":return e.stop()}}),e)}))),function(e){return Ht.apply(this,arguments)})}),Zt.add({id:"Combat.useMedsInFight",name:"use meds",cooldown:function(){return X.Event.MEDS_COOLDOWN},isAvailable:function(e){var t=e.getState();return t.events.enemys.length>0&&!t.events.won&&t.engine.activeSpace===exports.GameSpace.World},meta:{space:exports.GameSpace.World,cost:(Tt={},Tt[exports.StoreCategory.medicine]=1,Tt)},exec:(Ut=o(p.mark((function e(t){return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.events.doHeal(exports.StoreCategory.medicine,t.spaces.World.medsHeal());case 2:e.sent||t.operationExecutor.clearCooldown("Combat.useMedsInFight");case 4:case"end":return e.stop()}}),e)}))),function(e){return Ut.apply(this,arguments)})}),Zt.add({id:"Combat.useMeds",name:"use meds",isAvailable:function(e){var t=e.getState();return t.events.won&&t.engine.activeSpace===exports.GameSpace.World},meta:{space:exports.GameSpace.World,cost:(Nt={},Nt[exports.StoreCategory.cured_meat]=1,Nt)},exec:(Bt=o(p.mark((function e(t){return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.events.doHeal(exports.StoreCategory.medicine,t.spaces.World.medsHeal());case 2:e.sent||t.operationExecutor.clearCooldown("Combat.useMeds");case 4:case"end":return e.stop()}}),e)}))),function(e){return Bt.apply(this,arguments)})}),Zt.add({id:"Combat.leave",name:"leave",isAvailable:function(e){var t=e.getState();return t.events.won&&t.engine.activeSpace===exports.GameSpace.World},meta:{space:exports.GameSpace.World},exec:(jt=o(p.mark((function e(t){return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.events.endEvent();case 1:case"end":return e.stop()}}),e)}))),function(e){return jt.apply(this,arguments)})}),Object.keys(exports.WeaponCategory).forEach((function(e){var t,n,a=X.items[e];Zt.add({id:"Combat.useWeapon."+e,name:e,cooldown:function(e,t){var n=t.meta.weapon.cooldown;return e.getState().character.perks.unarmed_master&&(n/=2),n},isAvailable:function(e,t){var n=e.getState(),a=0;for(var r in exports.WeaponCategory){var o=X.items[r].weapon;if(n.game.world.outfit[r]){if("number"!=typeof(null==o?void 0:o.damage)||0===o.damage)a--;else if(o.cost)for(var i in o.cost)n.game.world.outfit[i]<o.cost[i]&&a--;a++}}var s=t.meta.name;return 0===a&&"fists"===s?n.events.enemys.length>0&&!n.events.won&&n.engine.activeSpace===exports.GameSpace.World:!!n.path.outfit[s]&&n.events.enemys.length>0&&!n.events.won&&n.engine.activeSpace===exports.GameSpace.World},meta:{space:exports.GameSpace.World,cost:null==(t=a.trade)?void 0:t.cost,weapon:a.weapon,name:e},exec:(n=o(p.mark((function e(t,n){var a,r,o,s,c,l,u,d;return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=n.meta.name,r=t.events.getActiveEvent(),o=t.getState(),r&&!(o.game.world.stunned&&o.game.world.stunned>=Date.now())){e.next=6;break}return t.operationExecutor.clearCooldown("Combat.useWeapon."+a),e.abrupt("return");case 6:if("unarmed"===(s=X.items[a].weapon).type&&(t.dispatch(t.actions.character.statistics.setM({punches:c=(o.character.statistics.punches||0)+1})),50!==c||o.character.perks.boxer?150!==c||o.character.perks.martial_artist?300!==c||o.character.perks.unarmed_master||t.dispatch(t.actions.character.perks.addPerk(exports.PerkCategory.unarmed_master)):t.dispatch(t.actions.character.perks.addPerk(exports.PerkCategory.martial_artist)):t.dispatch(t.actions.character.perks.addPerk(exports.PerkCategory.boxer))),null==s||!s.cost){e.next=21;break}l=i({},o.game.world.outfit),e.t0=p.keys(s.cost);case 12:if((e.t1=e.t0()).done){e.next=20;break}if(!(l[u=e.t1.value]<s.cost[u])){e.next=17;break}return t.operationExecutor.clearCooldown("Combat.useWeapon."+a),e.abrupt("return");case 17:l[u]=l[u]-s.cost[u],e.next=12;break;case 20:t.dispatch(t.actions.game.world.setM({outfit:l}));case 21:return d=-1,Math.random()<=t.events.getHitChance()&&"number"==typeof(d=null==s?void 0:s.damage)&&("unarmed"===(null==s?void 0:s.type)&&o.character.perks.boxer&&(d*=2),"unarmed"===(null==s?void 0:s.type)&&o.character.perks.martial_artist&&(d*=3),"unarmed"===(null==s?void 0:s.type)&&o.character.perks.unarmed_master&&(d*=2),"melee"===(null==s?void 0:s.type)&&o.character.perks.barbarian&&(d=Math.floor(1.5*d))),e.next=25,t.events.damageEnemy(d,s);case 25:t.getState().events.enemys[0].health<=0&&!o.events.won&&t.events.winFight();case 27:case"end":return e.stop()}}),e)}))),function(e,t){return n.apply(this,arguments)})})})),Zt.add({id:"Events.choice",name:"choice",isAvailable:function(e){var t=e.events.getActiveScene();return t&&t.buttons},help:function(e){var t=e.events.getActiveScene(),n=[];return Object.keys((null==t?void 0:t.buttons)||{}).forEach((function(e){n.push(e)})),{desc:"choice "+n.join(", "),parms:[n]}},exec:function(){var e=o(p.mark((function e(t,n,a){var r,o,i,s,c,l,u,d,h,m;return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.events.getActiveEvent()){e.next=3;break}return e.abrupt("return");case 3:if(o=t.getState(),s={},!(i=r.scenes[o.events.activeScene].buttons[a]).cost){e.next=25;break}e.t0=p.keys(i.cost);case 8:if((e.t1=e.t0()).done){e.next=18;break}if(c=e.t1.value,!((o.engine.activeSpace===exports.GameSpace.World?o.path.outfit[c]||0:o.stores[c]||0)<(i.cost[c]||0))){e.next=15;break}return t.notify("not enough "+c),e.abrupt("return",!1);case 15:s[c]=-(i.cost[c]||0),e.next=8;break;case 18:if(o.engine.activeSpace!==exports.GameSpace.World){e.next=23;break}return e.next=21,t.dispatch(t.actions.path.outfit.addM(s));case 21:e.next=25;break;case 23:return e.next=25,t.dispatch(t.actions.stores.addM(s));case 25:if("function"==typeof i.onChoose&&i.onChoose(t),!i.reward){e.next=29;break}return e.next=29,t.dispatch(t.actions.stores.addM(i.reward));case 29:if(i.notification&&t.notify(i.notification),!i.nextScene){e.next=47;break}if("end"!==(l=i.nextScene)){e.next=36;break}t.events.endEvent(),e.next=47;break;case 36:if("string"!=typeof l){e.next=40;break}t.events.loadScene(l),e.next=47;break;case 40:for(h in u=Math.random(),d=null,l)m=parseFloat(h),u<m&&(null==d||h<d)&&(d=h);if(null===d){e.next=46;break}return t.events.loadScene(l[d]),e.abrupt("return");case 46:t.events.endEvent();case 47:return e.abrupt("return",!0);case 48:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}()});var en=function(e){function t(t){var n;return(n=e.call(this,t)||this)._enemyAttackTimer=null,n.eventPool={Global:Yt,Room:zt,Outside:qt,World:Object.values(Qt),Fight:$t,Ship:[]},n.eventMap={Global:Yt,Room:zt,Outside:qt,Market:Kt},n.scheduleNextEvent(),n.initDelay(),n}s(t,e);var a=t.prototype;return a.winFight=function(){clearInterval(this._enemyAttackTimer),this.engine.dispatch(this.engine.actions.events.winFight())},a.getHitChance=function(){return this.engine.getState().character.perks.precise?X.World.BASE_HIT_CHANCE+.1:X.World.BASE_HIT_CHANCE},a.doHeal=function(){var e=o(p.mark((function e(t,n){var a,r,o,i;return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(a=this.engine.getState()).game.world.outfit[t]){e.next=11;break}return(r={})["outfit."+t]=(a.path.outfit[t]||0)-1,o=r,i=a.game.world.health+n,i=Math.min(this.engine.spaces.World.getMaxHealth(),i),o.health=i,e.next=8,this.engine.dispatch(this.engine.actions.game.world.setM(o));case 8:return e.abrupt("return",!0);case 11:this.engine.notify("not enough "+t);case 12:return e.abrupt("return",!1);case 13:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),a.getCurrentSpaceEventsPool=function(){var e=this.engine.getState().engine.activeSpace;return e===exports.GameSpace.World?[].concat(this.eventPool.World,this.eventPool.Fight):e===exports.GameSpace.Ship?[].concat(this.eventPool.Ship,this.eventPool.Global):[].concat(this.eventPool.Global,this.eventPool[e]||[])},a.triggerEvent=function(){if(this.engine.getState().engine.activeSpace!==exports.GameSpace.World&&null===this.getActiveEvent()){var e=this.getCurrentSpaceEventsPool(),t=[];for(var n in e){var a=e[n];a.isAvailable&&a.isAvailable(this.engine.store.getState(),this.engine)&&t.push(a)}if(0===t.length)return void this.scheduleNextEvent(.5);var r=Math.floor(Math.random()*t.length);this.startEvent(t[r])}this.scheduleNextEvent()},a.startEvent=function(){var e=o(p.mark((function e(t){var n,a,r;return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:if(n=this.getCurrentSpaceEventsPool(),-1===(a=n.indexOf(t))&&(a=n.findIndex((function(e){return e.id===t.id&&void 0!==e.id}))),!(r=a>-1?n[a].title:"")){e.next=11;break}return e.next=9,this.engine.dispatch(this.engine.actions.events.push(r));case 9:return e.next=11,this.loadScene("start");case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),a.loadScene=function(){var e=o(p.mark((function e(t){var n,a,r,o,i;return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.engine.getState(),a=n.events.eventStack[0],r=this.getCurrentSpaceEventsPool(),(o=r.find((function(e){return e.title===a})))||(t="end"),e.next=7,this.engine.dispatch(this.engine.actions.events.cleanEnemys());case 7:if(this.engine.dispatch(this.engine.actions.events.setM({activeScene:t})),i=null==o?void 0:o.scenes[t]){e.next=11;break}return e.abrupt("return");case 11:i.onLoad&&i.onLoad(this.engine),i.notification&&this.engine.notify(i.notification),i.reward&&this.engine.dispatch(this.engine.actions.stores.addM(i.reward)),i.combat?this.startCombat(i):this.startStory(i);case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),a.addEvent=function(e,t){this.eventPool[e].find((function(e){return e.id===t.id}))||this.eventPool[e].push(t)},a.startCombat=function(e){this.setRandomLoots(e.loot),this.engine.dispatch(this.engine.actions.events.setSceneEnemy(e)),clearInterval(this._enemyAttackTimer),this._enemyAttackTimer=this.engine.setInterval(this.enemyAttack.bind(this),1e3*e.attackDelay)},a.startStory=function(e){this.setRandomLoots(e.loot)},a.enemyAttack=function(){var e=o(p.mark((function e(){var t,n,a,r,o,i,s,c;return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.getActiveEvent()){e.next=3;break}return e.abrupt("return");case 3:if(n=this.engine.getState(),a=t.scenes[n.events.activeScene]){e.next=7;break}return e.abrupt("return");case 7:r=0,o=n.events.enemys.length;case 8:if(!(r<o)){e.next=20;break}if((i=n.events.enemys[r]).stunned){e.next=17;break}return s=a.hit,s*=n.character.perks.evasive?.8:1,c=-1,Math.random()<=s&&(c=a.damage),e.next=17,this.damageAdventurer(i,c);case 17:r++,e.next=8;break;case 20:this.engine.getState().game.world.health<=0&&(clearInterval(this._enemyAttackTimer),this.endEvent(),this.engine.spaces.World.die());case 22:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),a.damageEnemy=function(){var e=o(p.mark((function e(t,n){var a,r;return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=this.engine.getState(),r=a.events.enemys[0].health,"number"==typeof t?t<0?(t=0,this.engine.dispatch(this.engine.actions.events.logFight({time:Date.now(),type:"miss",target:"enemy",meta:{weapon:n}}))):(this.engine.dispatch(this.engine.actions.events.setM({"enemys[0].health":r=r-t<0?0:r-t})),this.engine.dispatch(this.engine.actions.events.logFight({time:Date.now(),type:"damage",target:"enemy",meta:{dmg:t,weapon:n}}))):"stun"==t&&(this.engine.dispatch(this.engine.actions.events.setM({"enemys[0].stunned":Date.now()+X.Event.STUN_DURATION})),this.engine.dispatch(this.engine.actions.events.logFight({time:Date.now(),type:"stunned",target:"enemy",meta:{weapon:n}})));case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),a.damageAdventurer=function(e,t){var n=this.engine.getState().game.world.health;"number"==typeof t?t<0?(this.engine.dispatch(this.engine.actions.events.logFight({time:Date.now(),type:"miss",target:"player"})),t=0):(this.engine.spaces.World.setHp(n=n-t<0?0:n-t),this.engine.dispatch(this.engine.actions.events.logFight({time:Date.now(),type:"damage",target:"player",meta:{dmg:t}}))):"stun"==t&&(this.engine.dispatch(this.engine.actions.game.world.setM({stunned:Date.now()+X.Event.STUN_DURATION})),this.engine.dispatch(this.engine.actions.events.logFight({time:Date.now(),type:"stunned",target:"player"})))},a.setRandomLoots=function(e){var t={};for(var n in e=e||{}){var a=e[n];if(Math.random()<a.chance){var r=Math.floor(Math.random()*(a.max-a.min))+a.min;t[n]=r}}this.engine.dispatch(this.engine.actions.events.setM({loot:t}))},a.triggerFight=function(){var e=[],t=this.engine.getState();for(var n in this.eventPool.Fight){var a=this.eventPool.Fight[n];a.isAvailable&&a.isAvailable(t,this.engine)&&e.push(a)}var r=Math.floor(Math.random()*e.length);this.startEvent(e[r])},a.scheduleNextEvent=function(e){var t=Math.floor(Math.random()*(X.Event.EVENT_TIME_RANGE[1]-X.Event.EVENT_TIME_RANGE[0]))+X.Event.EVENT_TIME_RANGE[0];e&&e>0&&(t*=e),Mt("next event scheduled in "+t+" minutes"),this.engine.setTimeout(this.triggerEvent.bind(this),60*t*1e3)},a.saveDelay=function(e,t,n){var a,r,i,s=this;n?null==(a=this.engine.store)||a.dispatch(this.engine.actions.delay.setM(((r={})[t]=n,r))):n=(null==(i=this.engine.store)?void 0:i.getState().delay[t])||0;var c=this.engine.setInterval((function(){var e,n,a;null==(e=s.engine.store)||e.dispatch(s.engine.actions.delay.setM(((a={})[t]=((null==(n=s.engine.store)?void 0:n.getState().delay[t])||0)-.5,a)))}),500);this.engine.setTimeout(o(p.mark((function n(){var a,r,o,i;return p.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return clearInterval(c),n.next=3,null==(a=s.engine.store)?void 0:a.dispatch(s.engine.actions.delay.setM(((r={})[t]=void 0,r)));case 3:return n.next=5,null==(o=s.engine.store)?void 0:o.dispatch(s.engine.actions.delay.removeM([t]));case 5:null==(i=s.engine.store)||i.dispatch(s.engine.actions.delay.clean()),e(s.engine);case 7:case"end":return n.stop()}}),n)}))),1e3*(n||0))},a.clean=function(){clearInterval(this._enemyAttackTimer),e.prototype.clean.call(this)},a.recallDelay=function(e,t){var a,r=n.get(null==(a=this.engine.store)?void 0:a.getState().events,e);for(var o in r)n.isObject(r[o])?this.recallDelay(e+'["'+o+'"]',t[o]):"function"==typeof t[o]&&t[o](this.engine)},a.initDelay=function(){var e,t=null==(e=this.engine.store)?void 0:e.getState().delay;for(var a in t)n.isObject(t[a])&&this.recallDelay(a,this.eventMap[a])},a.getActiveScene=function(){var e=this.engine.getState(),t=this.getActiveEvent();return t&&t.scenes[e.events.activeScene]||null},a.getActiveEvent=function(){var e=this.engine.getState();return e.events.eventStack.length>0&&this.getCurrentSpaceEventsPool().find((function(t){return t.title===e.events.eventStack[0]}))||null},a.endEvent=function(){this.engine.dispatch(this.engine.actions.events.end({}))},t}(Xt);Zt.add({id:"World.moveSouth",name:"south",isAvailable:function(e){var t=e.getState(),n=e.events.getActiveEvent();return t.engine.activeSpace===exports.GameSpace.World&&!n},meta:{space:exports.GameSpace.World},exec:function(){var e=o(p.mark((function e(t){return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.getState().game.world.curPos[1]<2*X.World.RADIUS&&t.spaces.World.move(X.World.SOUTH);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}),Zt.add({id:"World.moveNorth",name:"north",isAvailable:function(e){var t=e.getState(),n=e.events.getActiveEvent();return t.engine.activeSpace===exports.GameSpace.World&&!n},meta:{space:exports.GameSpace.World},exec:function(){var e=o(p.mark((function e(t){return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.getState().game.world.curPos[1]>0&&t.spaces.World.move(X.World.NORTH);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}),Zt.add({id:"World.moveWest",name:"west",isAvailable:function(e){var t=e.getState(),n=e.events.getActiveEvent();return t.engine.activeSpace===exports.GameSpace.World&&!n},meta:{space:exports.GameSpace.World},exec:function(){var e=o(p.mark((function e(t){return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.getState().game.world.curPos[0]>0&&t.spaces.World.move(X.World.WEST);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}),Zt.add({id:"World.moveEast",name:"east",isAvailable:function(e){var t=e.getState(),n=e.events.getActiveEvent();return t.engine.activeSpace===exports.GameSpace.World&&!n},meta:{space:exports.GameSpace.World},exec:function(){var e=o(p.mark((function e(t){return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.getState().game.world.curPos[0]<2*X.World.RADIUS&&t.spaces.World.move(X.World.EAST);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()});var tn,nn,an=function(e){function t(t){var n;n=e.call(this,t)||this;var a=t.store.getState();if(a.previous.stores&&(X.World.LANDMARKS[X.World.TILE.CACHE]={num:1,minRadius:10,maxRadius:1.5*X.World.RADIUS,scene:"cache",label:"A&nbsp;Destroyed&nbsp;Village"}),!a.features.location.Path){var r,o=n.generateMap(),i=n.newMask(),s=n.mapSearch(X.World.TILE.SHIP,o,1);s&&(r=n.compassDir(s[0])),t.dispatch(t.actions.game.world.setM({map:o,mask:i,ship:s,dir:r})),n.testMap()}return n}s(t,e);var a=t.prototype;return a.newMask=function(){for(var e=X.World.RADIUS,t=new Array(2*e+1),n=0;n<=2*e;n++)t[n]=new Array(2*e+1);return this.lightMap(e,e,t),t},a.lightMap=function(e,t,n){var a,r=null==(a=this.engine.store)?void 0:a.getState(),o=X.World.LIGHT_RADIUS;return this.uncoverMap(e,t,o*=null!=r&&r.character.perks.scout?2:1,n),n},a.uncoverMap=function(e,t,n,a){a[e][t]=!0;for(var r=-n;r<=n;r++)for(var o=-n+Math.abs(r);o<=n-Math.abs(r);o++)t+o>=0&&t+o<=2*X.World.RADIUS&&e+r<=2*X.World.RADIUS&&e+r>=0&&(a[e+r][t+o]=!0)},a.getTerrain=function(){var e=this.engine.getState(),t=e.game.world.curPos;return e.game.world.map[t[0]][t[1]]},a.markVisited=function(e,t){this.engine.dispatch(this.engine.actions.game.world.visit({x:e,y:t}))},a.clearDungeon=function(){var e=this.engine.getState();this.engine.dispatch(this.engine.actions.game.world.setMap({pos:e.game.world.curPos,value:X.World.TILE.OUTPOST})),this.drawRoad()},a.findClosestRoad=function(e){for(var t,n,a,r=this.engine.getState(),o=0,i=0,s=1,c=-1,l=0;l<Math.pow(this.getDistance(e,X.World.VILLAGE_POS)+2,2);l++){if(n=e[1]+i,0<(t=e[0]+o)&&t<2*X.World.RADIUS&&0<n&&n<2*X.World.RADIUS){var u=r.game.world.map[t][n];if(u===X.World.TILE.ROAD||u===X.World.TILE.OUTPOST&&(0!==o||0!==i)||u===X.World.TILE.VILLAGE)return[t,n]}0!==o&&0!==i||(a=s,s=-c,c=a),0===o&&i<=0?o++:(o+=s,i+=c)}return X.World.VILLAGE_POS},a.drawRoad=function(){var e=this.engine.getState().game.world,t=e.curPos,a=e.map;a=n.cloneDeep(a);var r,o,i=this.findClosestRoad(t),s=t[0]-i[0],c=t[1]-i[1],l=Math.abs(s)/s,u=Math.abs(c)/c;Math.abs(s)>Math.abs(c)?(r=i[0],o=i[1]+c):(r=i[0]+s,o=i[1]);for(var d=0;d<Math.abs(s);d++)this.isTerrain(a[i[0]+l*d][o])&&(a[i[0]+l*d][o]=X.World.TILE.ROAD);for(var h=0;h<Math.abs(c);h++)this.isTerrain(a[r][i[1]+u*h])&&(a[r][i[1]+u*h]=X.World.TILE.ROAD);this.engine.dispatch(this.engine.actions.game.world.setM({map:a}))},a.getMaxHealth=function(){var e=this.engine.store.getState();return e.stores.s_armour?X.World.BASE_HEALTH+35:e.stores.i_armour?X.World.BASE_HEALTH+15:e.stores.l_armou?X.World.BASE_HEALTH+5:X.World.BASE_HEALTH},a.applyMap=function(){var e=o(p.mark((function e(){var t,n,a,r,o;return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=(n=null==(t=this.engine.store)?void 0:t.getState())&&n.game.world.seenAll){e.next=7;break}o=n.game.world.mask;do{a=Math.floor(Math.random()*(2*X.World.RADIUS+1)),r=Math.floor(Math.random()*(2*X.World.RADIUS+1))}while(o[a][r]);return this.uncoverMap(a,r,5,o),e.next=7,this.engine.dispatch(this.engine.actions.game.world.setM({mask:o}));case 7:this.testMap();case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),a.testMap=function(){var e=o(p.mark((function e(){var t,n,a,r,o,i,s;return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=(n=null==(t=this.engine.store)?void 0:t.getState())&&n.game.world.seenAll){e.next=18;break}o=n.game.world.mask,i=0;case 4:if(!(i<o.length)){e.next=16;break}s=0;case 6:if(!(s<o[i].length)){e.next=13;break}if(o[i][s]){e.next=10;break}return r=!0,e.abrupt("break",16);case 10:s++,e.next=6;break;case 13:i++,e.next=4;break;case 16:return e.next=18,null==(a=this.engine.store)?void 0:a.dispatch(this.engine.actions.game.world.seeAll(!r));case 18:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),a.onArrival=function(){this.engine.dispatch(this.engine.actions.game.world.setM({water:this.getMaxWater(),health:this.getMaxHealth(),foodMove:0,waterMove:0,starvation:!1,thirst:!1,usedOutposts:{},curPos:n.cloneDeep(X.World.VILLAGE_POS),dead:!1}))},a.setHp=function(e){this.engine.dispatch(this.engine.actions.game.world.setM({health:Math.min(e,this.getMaxHealth())}))},a.setWater=function(e){var t=e,n=this.getMaxWater();t>n&&(t=n),this.engine.dispatch(this.engine.actions.game.world.setM({water:t}))},a.moveSouth=function(){this.engine.getState().game.world.curPos[1]<2*X.World.RADIUS&&this.move(X.World.SOUTH)},a.moveWest=function(){this.engine.getState().game.world.curPos[0]>0&&this.move(X.World.WEST)},a.moveEast=function(){this.engine.getState().game.world.curPos[0]<2*X.World.RADIUS&&this.move(X.World.EAST)},a.moveNorth=function(){this.engine.getState().game.world.curPos[1]>0&&this.move(X.World.NORTH)},a.move=function(){var e=o(p.mark((function e(t){var a,r,o,i,s,c;return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=this.engine.getState().game.world,r=a.map,i=a.curPos,s=a.danger,o=n.cloneDeep(o=a.mask),i=n.cloneDeep(i),c=r[i[0]][i[1]],i[0]+=t[0],i[1]+=t[1],this.narrateMove(c,r[i[0]][i[1]]),this.lightMap(i[0],i[1],o),e.next=10,this.engine.dispatch(this.engine.actions.game.world.setM({mask:o,curPos:i}));case 10:return e.next=12,this.doSpace();case 12:this.checkDanger()&&this.engine.notify(s?"dangerous to be this far from the village without proper protection":"safer here",exports.GameSpace.World);case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),a.useOutpost=function(){this.engine.dispatch(this.engine.actions.game.world.useOutpost()),this.setWater(this.getMaxWater()),this.engine.notify("water replenished")},a.getMaxWater=function(){var e=this.engine.store.getState();return e.stores.water_tank?X.World.BASE_WATER+50:e.stores.cask?X.World.BASE_WATER+20:e.stores.waterskin?X.World.BASE_WATER+10:X.World.BASE_WATER},a.generateMap=function(){for(var e=X.World.RADIUS,t=new Array(2*e+1),n=0;n<=2*e;n++)t[n]=new Array(2*e+1);t[e][e]=X.World.TILE.VILLAGE;for(var a=1;a<=e;a++)for(var r=0;r<8*a;r++){var o,i;r<2*a?(o=e-a+r,i=e-a):r<4*a?(o=e+a,i=e-3*a+r):r<6*a?(o=e+5*a-r,i=e+a):(o=e-a,i=e+7*a-r),t[o][i]=this.chooseTile(o,i,t)}for(var s in X.World.LANDMARKS)for(var c=X.World.LANDMARKS[s],l=0;l<c.num;l++)this.placeLandmark(c.minRadius,c.maxRadius,s,t);return t},a.chooseTile=function(e,t,n){var a,r=[t>0?n[e][t-1]:null,t<2*X.World.RADIUS?n[e][t+1]:null,e<2*X.World.RADIUS?n[e+1][t]:null,e>0?n[e-1][t]:null],o={},i=1;for(var s in r){if(r[s]==X.World.TILE.VILLAGE)return X.World.TILE.FOREST;"string"==typeof r[s]&&(o[r[s]]=(a="number"==typeof(a=o[r[s]])?a:0)+X.World.STICKINESS,i-=X.World.STICKINESS)}for(var c in X.World.TILE){var l=X.World.TILE[c];this.isTerrain(l)&&(a="number"==typeof(a=o[l])?a:0,o[l]=a+=X.World.TILE_PROBS[l]*i)}var u=[];for(var d in o)u.push(o[d]+""+d);u.sort((function(e,t){var n=parseFloat(e.substring(0,e.length-1));return parseFloat(t.substring(0,t.length-1))-n}));var h=0,m=Math.random();for(var p in u){var g=u[p];if(m<(h+=parseFloat(g.substring(0,g.length-1))))return g.charAt(g.length-1)}return X.World.TILE.BARRENS},a.placeLandmark=function(e,t,n,a){for(var r=X.World.RADIUS,o=X.World.RADIUS;!this.isTerrain(a[r][o]);){var i=Math.floor(Math.random()*(t-e))+e,s=Math.floor(Math.random()*i),c=i-s;Math.random()<.5&&(s=-s),Math.random()<.5&&(c=-c),(r=X.World.RADIUS+s)<0&&(r=0),r>2*X.World.RADIUS&&(r=2*X.World.RADIUS),(o=X.World.RADIUS+c)<0&&(o=0),o>2*X.World.RADIUS&&(o=2*X.World.RADIUS)}return a[r][o]=n,[r,o]},a.isTerrain=function(e){return e==X.World.TILE.FOREST||e==X.World.TILE.FIELD||e==X.World.TILE.BARRENS},a.mapSearch=function(e,t,n){var a=X.World.LANDMARKS[e].num;if(!a)return null;a=n?Math.min(n,a):a;var r=0,o=[],i=X.World.RADIUS;e:for(var s=0;s<=2*i;s++)for(var c=0;c<=2*i;c++)if(t[s][c].charAt(0)===e&&(o[r]={x:s-i,y:c-i},++r===a))break e;return o},a.compassDir=function(e){var t=e.x<0?"west":"east",n=e.y<0?"north":"south";return Math.abs(e.x)/2>Math.abs(e.y)?t:Math.abs(e.y)/2>Math.abs(e.x)?n:n+t},a.goHome=function(){var e=o(p.mark((function e(){var t;return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(t=this.engine.getState()).game.world.sulphurmine&&!t.game.buildings.sulphur_mine&&this.engine.dispatch(this.engine.actions.game.buildings.addM({sulphur_mine:1})),t.game.world.ironmine&&!t.game.buildings.iron_mine&&this.engine.dispatch(this.engine.actions.game.buildings.addM({iron_mine:1})),t.game.world.coalmine&&!t.game.buildings.coal_mine&&this.engine.dispatch(this.engine.actions.game.buildings.addM({coal_mine:1})),this.engine.dispatch(this.engine.actions.stores.addM(t.game.world.outfit)),this.engine.travelTo(exports.GameSpace.Path);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),a.getFreeSpace=function(){var e=this.engine.getState(),t=0;for(var n in e.game.world.outfit)t+=(e.game.world.outfit[n]||0)*this.engine.spaces.Path.getWeight(n);return this.engine.spaces.Path.getCapacity()-t},a.die=function(){this.engine.getState().game.world.dead||(this.engine.dispatch(this.engine.actions.game.world.setM({dead:!0})),this.engine.notify("the world fades",exports.GameSpace.World),this.engine.dispatch(this.engine.actions.path.outfit.empty()),this.engine.travelTo(exports.GameSpace.Room))},a.checkFight=function(){var e=this.engine.getState(),t=e.game.world.fightMove+1;if(t>X.World.FIGHT_DELAY){var n=X.World.FIGHT_CHANCE;n*=e.character.perks.stealthy?.5:1,Math.random()<n&&(t=0,this.engine.events.triggerFight())}this.engine.dispatch(this.engine.actions.game.world.setM({fightMove:t}))},a.narrateMove=function(e,t){var n=null;switch(e){case X.World.TILE.FOREST:switch(t){case X.World.TILE.FIELD:n="the trees yield to dry grass. the yellowed brush rustles in the wind.";break;case X.World.TILE.BARRENS:n="the trees are gone. parched earth and blowing dust are poor replacements."}break;case X.World.TILE.FIELD:switch(t){case X.World.TILE.FOREST:n="trees loom on the horizon. grasses gradually yield to a forest floor of dry branches and fallen leaves.";break;case X.World.TILE.BARRENS:n="the grasses thin. soon, only dust remains."}break;case X.World.TILE.BARRENS:switch(t){case X.World.TILE.FIELD:n="the barrens break at a sea of dying grass, swaying in the arid breeze.";break;case X.World.TILE.FOREST:n="a wall of gnarled trees rises from the dust. their branches twist into a skeletal canopy overhead."}}null!=n&&this.engine.notify(n,exports.GameSpace.World)},a.getDistance=function(e,t){return e||(e=this.engine.getState().game.world.curPos),t=t||X.World.VILLAGE_POS,Math.abs(e[0]-t[0])+Math.abs(e[1]-t[1])},a.outpostUsed=function(e,t){var n=this.engine.getState().game.world,a=n.curPos;return!0===n.usedOutposts[(e="number"==typeof e?e:a[0])+","+(t="number"==typeof t?t:a[1])]},a.useSupplies=function(){var e=o(p.mark((function e(){var t,n,a,r,o,i,s,c,l,u;return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.engine.getState(),r={foodMove:n=t.game.world.foodMove+1,waterMove:a=t.game.world.waterMove+1},o=X.World.MOVES_PER_FOOD,!(n>=(o*=t.character.perks.slow_metabolism?2:1))){e.next=33;break}if(n=0,r.foodMove=0,i=t.game.world.outfit.cured_meat||0,0!=--i){e.next=15;break}this.engine.notify("the meat has run out",exports.GameSpace.World),e.next=32;break;case 15:if(!(i<0)){e.next=30;break}if(i=0,t.game.world.starvation){e.next=22;break}this.engine.notify("starvation sets in",exports.GameSpace.World),r.starvation=!0,e.next=28;break;case 22:return this.engine.dispatch(this.engine.actions.character.statistics.setM({starved:s=t.character.statistics.starved+1})),s>=10&&!t.character.perks.slow_metabolism&&this.engine.dispatch(this.engine.actions.character.perks.addPerk(exports.PerkCategory.slow_metabolism)),this.engine.dispatch(this.engine.actions.game.world.setM(r)),this.die(),e.abrupt("return",!1);case 28:e.next=32;break;case 30:r.starvation=!1,r.health=Math.min(t.game.world.health+this.meatHeal(),this.getMaxHealth());case 32:r["outfit.cured_meat"]=i;case 33:if(c=X.World.MOVES_PER_WATER,!(a>=(c*=t.character.perks.desert_rat?2:1))){e.next=61;break}if(a=0,r.waterMove=0,l=t.game.world.water,0!=--l){e.next=44;break}this.engine.notify("there is no more water",exports.GameSpace.World),e.next=60;break;case 44:if(!(l<0)){e.next=59;break}if(l=0,t.game.world.thirst){e.next=51;break}this.engine.notify("the thirst becomes unbearable",exports.GameSpace.World),r.thirst=!0,e.next=57;break;case 51:return this.engine.dispatch(this.engine.actions.character.statistics.setM({dehydrated:u=t.character.statistics.dehydrated+1})),u>=10&&!t.character.perks.desert_rat&&this.engine.dispatch(this.engine.actions.character.perks.addPerk(exports.PerkCategory.desert_rat)),this.engine.dispatch(this.engine.actions.game.world.setM(r)),this.die(),e.abrupt("return",!1);case 57:e.next=60;break;case 59:r.thirst=!1;case 60:r.water=l;case 61:return e.next=63,this.engine.dispatch(this.engine.actions.game.world.setM(r));case 63:return e.abrupt("return",!0);case 64:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),a.meatHeal=function(){var e=this.engine.getState();return X.World.MEAT_HEAL*(e.character.perks.gastronome?2:1)},a.medsHeal=function(){return X.World.MEDS_HEAL},a.checkDanger=function(){var e=this.engine.getState();if(e.game.world.danger){if(this.getDistance()<8)return this.engine.dispatch(this.engine.actions.game.world.setM({danger:!1})),!0;if(this.getDistance()<18&&(e.stores.i_armour||0)>0)return this.engine.dispatch(this.engine.actions.game.world.setM({danger:!1})),!0}else{if(!e.stores.i_armour&&this.getDistance()>=8)return this.engine.dispatch(this.engine.actions.game.world.setM({danger:!0})),!0;if(!e.stores.s_armour&&this.getDistance()>=18)return this.engine.dispatch(this.engine.actions.game.world.setM({danger:!0})),!0}return!1},a.doSpace=function(){var e=o(p.mark((function e(){var t,n,a,r;return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.engine.getState().game.world,(a=t.map[(n=t.curPos)[0]][n[1]])!==X.World.TILE.VILLAGE){e.next=6;break}this.goHome(),e.next=14;break;case 6:if(void 0===X.World.LANDMARKS[a]){e.next=10;break}a===X.World.TILE.OUTPOST&&this.outpostUsed()||(r=this.engine.events.eventPool.World.find((function(e){return e.id===X.World.LANDMARKS[a].scene})))&&this.engine.events.startEvent(r),e.next=14;break;case 10:return e.next=12,this.useSupplies();case 12:e.sent&&this.checkFight();case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),t}(Xt);function rn(e){return"weapon"==e||"upgrade"==e||"tool"==e}Zt.add({id:"Room.lightFire",name:"light fire",isAvailable:function(e){var t=e.getState();return!t.engine.activeSubSpace&&t.engine.activeSpace===exports.GameSpace.Room&&t.game.fire.status.value===X.Room.FireStatus.Dead.value},exec:function(){var e=o(p.mark((function e(t){var n,a,r,o;return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.spaces.Room,a=t.getState(),o=a.game.fire.status,void 0===(r=a.stores.wood)){e.next=17;break}if(!((r=r||0)<5)){e.next=12;break}return t.notify("not enough wood to get the fire going",exports.GameSpace.Room),t.operationExecutor.clearCooldown("Room.lightFire"),e.abrupt("return",o);case 12:if(!(r>4)){e.next=15;break}return e.next=15,t.dispatch(t.actions.stores.addM({wood:-5}));case 15:e.next=21;break;case 17:return e.next=19,t.dispatch(t.actions.stores.addM({wood:5}));case 19:return e.next=21,t.operationExecutor.cooldown("Room.stokeFire");case 21:return o=X.Room.FireStatus.Burning,e.next=24,t.dispatch(t.actions.game.fire.changeFire(o));case 24:return n.onFireChange(o),e.abrupt("return",o);case 26:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),cooldown:function(){return X.Room.STOKE_COOLDOWN},meta:{space:exports.GameSpace.Room,cost:(tn={},tn[exports.StoreCategory.wood]=5,tn)}}),Zt.add({id:"Room.stokeFire",name:"stoke fire",isAvailable:function(e){var t=e.getState();return!t.engine.activeSubSpace&&t.engine.activeSpace===exports.GameSpace.Room&&t.game.fire.status.value!==X.Room.FireStatus.Dead.value},exec:function(){var e=o(p.mark((function e(t){var a,r,o,i;return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.getState(),r=t.spaces.Room,o=a.game.fire.status,a.stores.wood){e.next=8;break}return t.notify("the wood has run out",exports.GameSpace.Room),t.operationExecutor.clearCooldown("Room.stokeFire"),e.abrupt("return",o);case 8:return e.next=10,t.dispatch(t.actions.stores.addM({wood:-1}));case 10:if(!(o.value<X.Room.FireStatus.Roaring.value)){e.next=16;break}if(!(i=n.findKey(X.Room.FireStatus,(function(e){return e.value===o.value+1})))){e.next=16;break}return o=X.Room.FireStatus[i],e.next=16,t.dispatch(t.actions.game.fire.changeFire(o));case 16:return r.onFireChange(o),e.abrupt("return",o);case 18:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),cooldown:function(){return X.Room.STOKE_COOLDOWN},meta:{space:exports.GameSpace.Room,cost:(nn={},nn[exports.StoreCategory.wood]=1,nn)}}),Zt.add({id:"Room.stores",name:"warehouse",isAvailable:function(e){var t=e.getState();return!t.engine.activeSubSpace&&t.engine.activeSpace===exports.GameSpace.Room&&void 0!==t.stores.wood},exec:function(){var e=o(p.mark((function e(t){var n,a,r,o,i,s,c;return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n=t.getState(),a=Object.keys(n.stores),r=[],o=0,i=a.length;o<i;o++)(c=n.stores[s=a[o]])&&X.items[s]&&"building"!==X.items[s].type&&r.push({name:s,count:c,info:X.items[s]});return e.abrupt("return",r);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),meta:{space:exports.GameSpace.Room}}),Zt.add({id:"Room.trading_post",name:"trading post",isAvailable:function(e){var t=e.getState();return!t.engine.activeSubSpace&&t.engine.activeSpace===exports.GameSpace.Room&&!!t.game.buildings.trading_post},meta:{space:exports.GameSpace.Room},exec:function(){var e=o(p.mark((function e(t,n){return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.travelToSubSpace(n.name);case 2:return e.abrupt("return",n.name);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}),Zt.add({id:"Room.workshop",name:"workshop",isAvailable:function(e){var t=e.getState();return!t.engine.activeSubSpace&&t.engine.activeSpace===exports.GameSpace.Room&&!!t.game.buildings.workshop},meta:{space:exports.GameSpace.Room},exec:function(){var e=o(p.mark((function e(t,n){return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.travelToSubSpace(n.name);case 2:return e.abrupt("return",n.name);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}),Object.keys(exports.TradeCategory).forEach((function(e){Zt.add({id:"Room.buy."+e,name:e,isAvailable:function(e,t){return"trading post"===e.getState().engine.activeSubSpace&&e.spaces.Room.buyUnlocked(t.meta.thing)},meta:{thing:e,space:exports.GameSpace.Room,group:"buy"},exec:function(){var e=o(p.mark((function e(t,n){var a,r,o,i,s,c,l,u,d;return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.meta.thing,o=t.getState(),(s=o.stores[r]||0)<0&&(s=0),(i=X.items[r]).trade){e.next=7;break}return e.abrupt("return",!1);case 7:if(!(i.trade.maximum&&i.trade.maximum<s)){e.next=10;break}return t.notify("can't buy any more of "+i.name,exports.GameSpace.Room),e.abrupt("return",!1);case 10:c={},l=i.trade.cost(),e.t0=p.keys(l);case 13:if((e.t1=e.t0()).done){e.next=24;break}if(!((d=o.stores[u=e.t1.value]||0)<l[u])){e.next=21;break}return t.notify("not enough "+u+", need "+l[u]+", stock "+d,exports.GameSpace.Room),e.abrupt("return",!1);case 21:c[u]=d-l[u];case 22:e.next=13;break;case 24:return e.next=26,t.dispatch(t.actions.stores.addM(c));case 26:return e.next=28,e.sent;case 28:return i.trade.tradeMsg&&t.notify(i.trade.tradeMsg),e.next=31,t.dispatch(t.actions.stores.addM(((a={})[r]=1,a)));case 31:return e.abrupt("return",!0);case 32:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()})})),Object.keys(exports.CraftableCategory).forEach((function(e){var t=rn(X.items[e].craft.type)?"craft":"build";Zt.add({id:"Room."+t+"."+e,name:e,isAvailable:function(e,t){var n=e.getState(),a=t.meta.thing;return"craft"===t.meta.group?"workshop"===n.engine.activeSubSpace&&n.engine.activeSpace===exports.GameSpace.Room&&e.spaces.Room.craftUnlocked(a):!n.engine.activeSubSpace&&n.engine.activeSpace===exports.GameSpace.Room&&e.spaces.Room.craftUnlocked(a)},meta:{thing:e,space:exports.GameSpace.Room,group:t},exec:function(){var e=o(p.mark((function e(t,n){var a,r,o,i,s,c,l,u,d,h,m,g;return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=n.meta.thing,!((s=t.getState()).game.temperature.status.value<=X.Room.TemperatureStatus.Cold.value)){e.next=5;break}return t.notify("builder just shivers",exports.GameSpace.Room),e.abrupt("return",!1);case 5:if((c=X.items[i]).craft){e.next=8;break}return e.abrupt("return",!1);case 8:l=0,e.t0=c.type,e.next="good"===e.t0||"weapon"===e.t0||"tool"===e.t0||"upgrade"===e.t0?12:"building"===e.t0?14:16;break;case 12:return l=s.stores[i]||0,e.abrupt("break",16);case 14:return l=s.game.buildings[i]||0,e.abrupt("break",16);case 16:if(l<0&&(l=0),!(c.craft.maximum&&c.craft.maximum<=l)){e.next=20;break}return t.notify("can't build any more of "+c.name,exports.GameSpace.Room),e.abrupt("return",!1);case 20:u={},d=c.craft.cost(s),e.t1=p.keys(d);case 23:if((e.t2=e.t1()).done){e.next=34;break}if(!((m=s.stores[h=e.t2.value]||0)<d[h])){e.next=31;break}return t.notify("not enough "+h+", need "+d[h]+", stock "+m,exports.GameSpace.Room),e.abrupt("return",!1);case 31:u[h]=m-d[h];case 32:e.next=23;break;case 34:return e.next=36,t.setToStore(u);case 36:c.craft.buildMsg&&t.notify(null==(g=c.craft)?void 0:g.buildMsg,exports.GameSpace.Room),e.t3=null==(a=c.craft)?void 0:a.type,e.next="good"===e.t3||"weapon"===e.t3||"upgrade"===e.t3||"tool"===e.t3?40:"building"===e.t3?43:46;break;case 40:return e.next=42,t.addToStore(((r={})[i]=1,r));case 42:return e.abrupt("break",46);case 43:return e.next=45,t.dispatch(t.actions.game.buildings.addM(((o={})[i]=1,o)));case 45:return e.abrupt("break",46);case 46:return e.abrupt("return",!0);case 47:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()})}));var on=function(e){function t(t){var n;(n=e.call(this,t)||this)._fireTimer=null,n._tempTimer=null,n._builderTimer=null;var a=t.getState();a.features.location.Room||(t.dispatch(t.actions.features.location.enableRoom()),t.dispatch(t.actions.game.builder.setM({level:-1}))),n._fireTimer=t.setTimeout(n.coolFire.bind(c(n)),X.Room.FIRE_COOL_DELAY),n._tempTimer=t.setTimeout(n.adjustTemp.bind(c(n)),X.Room.ROOM_WARM_DELAY);var r=a.game.builder.level;return r>=0&&r<3&&(n._builderTimer=t.setTimeout(n.updateBuilderState.bind(c(n)),X.Room.BUILDER_STATE_DELAY)),1==r&&void 0===a.stores.wood&&n.engine.setTimeout(n.unlockForest.bind(c(n)),X.Room.NEED_WOOD_DELAY),n.engine.observer((function(e){return{wood:e.stores.wood,meat:e.stores.meat,fur:e.stores.fur,thieves:e.game.thieves,enableWorld:e.features.location.World}}),(function(e){!e.thieves&&e.enableWorld&&((e.wood||0)>5e3||(e.meat||0)>5e3||(e.fur||0)>5e3)&&n.startThieves()})),n}s(t,e);var a=t.prototype;return a.coolFire=function(){var e=this.engine.getState(),t=e.game.fire.status;t.value<=X.Room.FireStatus.Flickering.value&&e.game.builder.level>3&&e.stores.wood&&(this.engine.notify("builder stokes the fire",exports.GameSpace.Room,!0),this.engine.dispatch(this.engine.actions.stores.addM({wood:-1})),t=X.Room.FireStatus[n.findKey(X.Room.FireStatus,(function(e){return e.value===t.value+1}))]),t.value>0&&(t=X.Room.FireStatus[n.findKey(X.Room.FireStatus,(function(e){return e.value===t.value-1}))],this.engine.dispatch(this.engine.actions.game.fire.changeFire(t)),this.onFireChange(t))},a.onArrival=function(){var e=this.engine.getState();e.room.changed&&(this.engine.notify("the fire is "+e.game.fire.status.text),this.engine.notify("the room is "+e.game.temperature.status.text),this.engine.dispatch(this.engine.actions.room.setChanged(!1))),3===e.game.builder.level&&(this.engine.dispatch(this.engine.actions.game.builder.addM({level:1})),this.engine.setIncome("builder",{delay:10,stores:{wood:2}}),this.engine.notify("the stranger is standing by the fire. she says she can help. says she builds things.",exports.GameSpace.Room))},a.canTrade=function(e){var t=this.engine.getState();return!!t.room.crafts[e]||t.game.buildings.trading_post>0&&(e===exports.StoreCategory.compass||void 0!==t.stores[e])},a.buyUnlocked=function(e){var t=this.engine.getState();return!!t.room.buys[e]||!(!t.game.buildings.trading_post||e!==exports.StoreCategory.compass&&void 0===t.stores[e])},a.clean=function(){clearTimeout(this._fireTimer),clearTimeout(this._tempTimer),clearTimeout(this._builderTimer),e.prototype.clean.call(this)},a.craftUnlocked=function(e){var t=this.engine.getState();if(t.room.crafts[e])return!0;if(t.game.builder.level<4)return!1;var n=X.items[e];if(!n.craft)return!1;if(rn(n.type)&&0===t.game.buildings.workshop)return!1;var a=n.craft.cost(t);if(t.game.buildings[e]>0)return this.engine.dispatch(this.engine.actions.room.addCraft({name:e})),!0;if(a.wood&&(t.stores.wood||0)<.5*a.wood)return!1;for(var r in a)if(!t.stores[r])return!1;return this.engine.dispatch(this.engine.actions.room.addCraft({name:e})),n.craft.availableMsg&&!t.game.buildings[e]&&this.engine.notify(n.craft.availableMsg,exports.GameSpace.Room),!0},a.adjustTemp=function(){var e=this.engine.getState(),t=e.game.temperature.status,a=t,r=e.game.fire.status;t.value>0&&t.value>r.value&&(a=X.Room.TemperatureStatus[n.findKey(X.Room.TemperatureStatus,(function(e){return e.value===a.value-1}))],this.engine.notify("the room is "+a.text,exports.GameSpace.Room,!0)),a.value<4&&a.value<r.value&&(a=X.Room.TemperatureStatus[n.findKey(X.Room.TemperatureStatus,(function(e){return e.value===a.value+1}))],this.engine.notify("the room is "+a.text,exports.GameSpace.Room,!0)),a.value!=t.value&&(this.engine.dispatch(this.engine.actions.room.setChanged(!0)),this.engine.dispatch(this.engine.actions.game.temperature.change(a))),this._tempTimer=this.engine.setTimeout(this.adjustTemp.bind(this),X.Room.ROOM_WARM_DELAY)},a.onFireChange=function(e){var t=this.engine.getState();t.engine.activeSpace!==exports.GameSpace.Room&&this.engine.dispatch(this.engine.actions.room.setChanged(!0)),this.engine.notify("the fire is "+e.text,exports.GameSpace.Room,!0),e.value>X.Room.FireStatus.Smoldering.value&&t.game.builder.level<0&&(this.engine.dispatch(this.engine.actions.game.builder.setM({level:0})),this.engine.notify("the light from the fire spills from the windows, out into the dark",exports.GameSpace.Room),this.engine.setTimeout(this.updateBuilderState.bind(this),X.Room.BUILDER_STATE_DELAY)),clearTimeout(this._fireTimer),this._fireTimer=this.engine.setTimeout(this.coolFire.bind(this),X.Room.FIRE_COOL_DELAY)},a.updateBuilderState=function(){if(this.engine){var e=this.engine.getState(),t=e.game.builder.level;if(0===t)this.engine.notify("a ragged stranger stumbles through the door and collapses in the corner",exports.GameSpace.Room),t=1,this.engine.dispatch(this.engine.actions.game.builder.setM({level:1})),this.engine.setTimeout(this.unlockForest.bind(this),X.Room.NEED_WOOD_DELAY);else if(t<3&&e.game.temperature.status.value>=X.Room.TemperatureStatus.Warm.value){var n="";switch(t){case 1:n="the stranger shivers, and mumbles quietly. her words are unintelligible.";break;case 2:n="the stranger in the corner stops shivering. her breathing calms."}this.engine.notify(n,exports.GameSpace.Room),t<3&&this.engine.dispatch(this.engine.actions.game.builder.setM({level:t+=1}))}t<3&&this.engine.setTimeout(this.updateBuilderState.bind(this),X.Room.BUILDER_STATE_DELAY)}},a.unlockForest=function(){this.engine.dispatch(this.engine.actions.stores.setM({wood:4})),this.engine.dispatch(this.engine.actions.features.location.enableOutside()),this.engine.notify("the wind howls outside",exports.GameSpace.Room),this.engine.notify("the wood is running out",exports.GameSpace.Room)},a.startThieves=function(){this.engine.dispatch(this.engine.actions.game.thieves.change(1)),this.engine.setIncome("thieves",{delay:10,stores:{wood:-10,fur:-5,meat:-5}})},t}(Xt);Zt.add({id:"Path.perks",name:"perks",isAvailable:function(e){var t=e.getState();if(t.engine.activeSubSpace||t.engine.activeSpace!==exports.GameSpace.Path)return!1;var n=!1;for(var a in t.character.perks)if(t.character.perks[a]){n=!0;break}return n},exec:function(){var e=o(p.mark((function e(t){var n,a,r;return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r in n=t.getState(),a=[],n.character.perks)n.character.perks[r]&&a.push({name:r,desc:y[r].desc});return e.abrupt("return",a);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),meta:{space:exports.GameSpace.Path}}),Zt.add({id:"Path.embark",name:"embark",cooldown:function(){return X.World.DEATH_COOLDOWN},isAvailable:function(e){return e.getState().engine.activeSpace===exports.GameSpace.Path},meta:{space:exports.GameSpace.Path},exec:function(){var e=o(p.mark((function e(t){var a,r,o,i,s,c;return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(i in a=t.getState(),r=a.path.outfit,o={},a)o[i]=-1*(r[i]||0);return e.next=6,t.dispatch(t.actions.stores.addM(o));case 6:for(c in s={},r)r[c]&&(s[c]=r[c]);return e.next=10,t.dispatch(t.actions.game.world.setM({outfit:n.cloneDeep(s)}));case 10:return e.next=12,t.travelTo(exports.GameSpace.World);case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()});var sn,cn,ln=function(e){function t(t){var n;return(n=e.call(this,t)||this).engine.observer((function(e){return{compass:e.stores.compass,pathEnable:e.features.location.Path}}),(function(e){e.compass&&!e.pathEnable&&n.openPath()})),n}s(t,e);var n=t.prototype;return n.onArrival=function(){this.updateOutfitting()},n.openPath=function(){var e=o(p.mark((function e(){var t;return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.engine.getState(),e.next=3,this.engine.dispatch(this.engine.actions.features.location.enablePath());case 3:this.engine.notify("the compass points "+t.game.world.dir);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),n.getWeight=function(e){var t=X.Path.Weight[e];return"number"!=typeof t&&(t=1),t},n.getCapacity=function(){var e=this.engine.getState();return e.stores.convoy?X.Path.DEFAULT_BAG_SPACE+60:e.stores.wagon?X.Path.DEFAULT_BAG_SPACE+30:e.stores.rucksack?X.Path.DEFAULT_BAG_SPACE+10:X.Path.DEFAULT_BAG_SPACE},n.getFreeSpace=function(){var e=this.engine.getState(),t=0;for(var n in e.path.outfit)t+=(e.path.outfit[n]||0)*this.getWeight(n);return this.getCapacity()-t},n.updateOutfitting=function(){var e=this.engine.getState(),t=Object.keys(N).concat(Object.keys(exports.CraftableCategory)),n=!1,a={};for(var r in t){var o=e.stores[r]||0,i=e.path.outfit[r]||0;o<(i="number"==typeof i?i:0)&&(n=!0,a[r]=i=o)}n&&this.engine.dispatch(this.engine.actions.path.outfit.setM(a))},n.increaseSupply=function(){var e=o(p.mark((function e(t,n){var a,r,o,i,s,c,l,u;return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this.engine.getState(),r=a.path.outfit[t]||0,o=this.getFreeSpace(),i=this.getWeight(t),s=a.stores[t]||0,c=0,!(o>=i&&r<s)){e.next=14;break}if(l=Math.floor(o/i),!(c=Math.min(n,l,s-r))){e.next=14;break}return e.next=13,this.engine.dispatch(this.engine.actions.path.outfit.addM(((u={})[t]=c,u)));case 13:this.updateOutfitting();case 14:return e.abrupt("return",r+c);case 15:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),n.decreaseSupply=function(){var e=o(p.mark((function e(t,n){var a,r,o,i;return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this.engine.getState(),!(r=a.path.outfit[t]||0)){e.next=8;break}if(o=Math.max(0,r-n),r===o){e.next=8;break}return e.next=7,this.engine.dispatch(this.engine.actions.path.outfit.setM(((i={})[t]=o,i)));case 7:this.updateOutfitting();case 8:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),t}(Xt);Zt.add({id:"Ship.reinforceHull",name:"reinforce hull",cooldown:function(){return X.Ship.ALLOY_PER_HULL},isAvailable:function(e){return e.getState().engine.activeSpace===exports.GameSpace.Ship},meta:{space:exports.GameSpace.Ship,cost:(sn={},sn[exports.StoreCategory.alien_alloy]=X.Ship.ALLOY_PER_HULL,sn)},exec:function(){var e=o(p.mark((function e(t){return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((t.getState().stores.alien_alloy||0)<X.Ship.ALLOY_PER_HULL)){e.next=4;break}return t.notify("not enough alien alloy",exports.GameSpace.Ship),e.abrupt("return",!1);case 4:return e.next=6,t.dispatch(t.actions.stores.addM({alien_alloy:-1*X.Ship.ALLOY_PER_HULL}));case 6:return e.next=8,t.dispatch(t.actions.game.spaceShip.addM({hull:1}));case 8:return e.abrupt("return",!0);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}),Zt.add({id:"Ship.upgradeEngine",name:"upgrade engine",cooldown:function(){return X.Ship.ALLOY_PER_THRUSTER},isAvailable:function(e){return e.getState().engine.activeSpace===exports.GameSpace.Ship},meta:{space:exports.GameSpace.Ship,cost:(cn={},cn[exports.StoreCategory.alien_alloy]=X.Ship.ALLOY_PER_THRUSTER,cn)},exec:function(){var e=o(p.mark((function e(t){return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((t.getState().stores.alien_alloy||0)<X.Ship.ALLOY_PER_THRUSTER)){e.next=4;break}return t.notify("not enough alien alloy",exports.GameSpace.Ship),e.abrupt("return",!1);case 4:return e.next=6,t.dispatch(t.actions.stores.addM({alien_alloy:-1*X.Ship.ALLOY_PER_THRUSTER}));case 6:return e.next=8,t.dispatch(t.actions.game.spaceShip.addM({thrusters:1}));case 8:return e.abrupt("return",!0);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}),Zt.add({id:"Ship.checkLiftOff",name:"lift off",cooldown:function(){return 0},isAvailable:function(e){return e.getState().engine.activeSpace===exports.GameSpace.Ship},meta:{space:exports.GameSpace.Ship},exec:function(){var e=o(p.mark((function e(t){var n;return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n={title:"Ready to Leave?",id:"ship_check_lift_off",scenes:{start:{text:["time to get out of this place. won't be coming back."],buttons:{fly:{text:"lift off",onChoose:function(e){e.dispatch(e.actions.game.spaceShip.setM({seenWarning:!0}));var t=e.prestige.calculateScore();e.notify("game end"),e.notify("score for this game: "+t),e.notify("https://adarkroom.doublespeakgames.com"),e.spaces.Ship.liftOff()},nextScene:"end"},wait:{text:"linger",onChoose:function(){},nextScene:"end"}}}}},t.events.addEvent("Ship",n),t.events.startEvent(n);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()});var un,dn=function(e){function t(t){return e.call(this,t)||this}s(t,e);var n=t.prototype;return n.onArrival=function(){this.engine.getState().game.spaceShip.seenShip||(this.engine.notify("somewhere above the debris cloud, the wanderer fleet hovers. been on this rock too long.",exports.GameSpace.Ship),this.engine.dispatch(this.engine.actions.game.spaceShip.setM({seenShip:!0})))},n.getMaxHull=function(){return this.engine.getState().game.spaceShip.hull||0},n.liftOff=function(){this.engine.travelTo(exports.GameSpace.Space)},t}(Xt),hn=function(e){function t(t){return e.call(this,t)||this}return s(t,e),t.prototype.onArrival=function(){this.engine.endGame()},t}(Xt);Zt.add({id:"Outside.checkTraps",name:"check traps",isAvailable:function(e){return e.getState().engine.activeSpace===exports.GameSpace.Outside},cooldown:function(){return X.Outside.TRAPS_DELAY},exec:function(){var e=o(p.mark((function e(t){var n,a,r,o,i,s,c,l,u,d,h,m,g;return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.getState(),a={},r=[],o=n.game.buildings.trap||0){e.next=9;break}return t.notify("not enough trap"),e.next=8,t.operationExecutor.clearCooldown("Outside.checkTraps");case 8:return e.abrupt("return");case 9:s=o+((i=n.stores.bait||0)<o?i:o),c=0;case 12:if(!(c<s)){e.next=28;break}l=Math.random(),e.t0=p.keys(X.Outside.TrapDrops);case 15:if((e.t1=e.t0()).done){e.next=25;break}if(!(l<(u=X.Outside.TrapDrops[e.t1.value]).rollUnder)){e.next=23;break}return void 0===(d=a[u.name])&&(d=0,r.push(u.message)),a[u.name]=d+1,e.abrupt("break",25);case 23:e.next=15;break;case 25:c++,e.next=12;break;case 28:for(h="the traps contain ",m=0,g=r.length;m<g;m++)g>1&&m>0&&m<g-1?h+=", ":g>1&&m==g-1&&(h+=" and "),h+=r[m];return a.bait=-(i<o?i:o),t.notify(h,exports.GameSpace.Outside),e.next=35,t.dispatch(t.actions.stores.addM(a));case 35:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),meta:{buildings:(un={},un[exports.Building.trap]=1,un),space:exports.GameSpace.Outside}}),Zt.add({id:"Outside.gatherWood",name:"gather wood",isAvailable:function(e){return e.getState().engine.activeSpace===exports.GameSpace.Outside},cooldown:function(){return X.Outside.GATHER_DELAY},exec:function(){var e=o(p.mark((function e(t){var n,a;return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.notify("dry brush and dead branches litter the forest floor",exports.GameSpace.Outside),n=t.getState(),a=n.game.buildings.cart?50:10,e.next=5,t.dispatch(t.actions.stores.addM({wood:a}));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),meta:{space:exports.GameSpace.Outside}}),Zt.add({id:"Outside.building",name:"Buildings",isAvailable:function(e){var t=e.getState();if(t.engine.activeSpace!==exports.GameSpace.Outside)return!1;for(var n=!1,a=Object.keys(t.stores),r=0,o=a.length;r<o;r++){var i=a[r];if(t.stores[i]&&X.items[i]&&"building"===X.items[i].type){n=!0;break}}return n},exec:function(){var e=o(p.mark((function e(t){var n,a,r,o,i,s,c;return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n=t.getState(),a=Object.keys(n.stores),r=[],o=0,i=a.length;o<i;o++)(c=n.stores[s=a[o]])&&X.items[s]&&"building"===X.items[s].type&&r.push({name:s,count:c,info:X.items[s]});return e.abrupt("return",r);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),meta:{space:exports.GameSpace.Outside}});var mn=function(e){function t(t){var n;return(n=e.call(this,t)||this)._popTimeout=null,n.unsubBuilding=function(){},n.updateVillageIncome(),n.schedulePopIncrease(),n.unsubBuilding=t.observer((function(e){return e.game.buildings}),(function(){n.enableBuildingWorker()})),n}s(t,e);var a=t.prototype;return a.onArrival=function(){this.engine.getState().game.outside.seenForest||(this.engine.notify("the sky is grey and the wind blows relentlessly",exports.GameSpace.Outside),this.engine.dispatch(this.engine.actions.game.outside.setM({seenForest:!0})))},a.increaseWorker=function(e,t){var n=this.getNumGatherers();if(n>0){var a,r=Math.min(n,t);Mt("increasing "+e+" by "+r),this.engine.dispatch(this.engine.actions.game.workers.addM(((a={})[e]=r,a)))}},a.getTitle=function(){var e=this.engine.getState().game.buildings.hut||0;return 0===e?"A Silent Forest":1==e?"A Lonely Hut":e<=4?"A Tiny Village":e<=8?"A Modest Village":e<=14?"A Large Village":"A Raucous Village"},a.decreaseWorker=function(e,t){var n=this.engine.getState().game.workers[e]||0;if(n>0){var a,r=Math.min(n,t);Mt("decreasing "+e+" by "+r),this.engine.dispatch(this.engine.actions.game.workers.addM(((a={})[e]=-1*r,a)))}},a.clean=function(){clearTimeout(this._popTimeout),this.unsubBuilding(),e.prototype.clean.call(this)},a.destroyHuts=function(){var e=o(p.mark((function e(t,n){var a,r,o,i,s,c,l,u,d,h,m;return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=this.engine.getState(),r=0,i=o=a.game.buildings.hut,s=0;case 5:if(!(s<t)){e.next=20;break}if(l=(c=a.game.population.value)/X.Outside.HUT_ROOM,u=Math.floor(l),d=n?i:Math.ceil(l)){e.next=12;break}return e.abrupt("break",20);case 12:h=Math.floor(Math.random()*d)+1,m=0,h<=u?m=X.Outside.HUT_ROOM:h===u+1&&(m=c%X.Outside.HUT_ROOM),i--,m&&(r+=m);case 17:s++,e.next=5;break;case 20:if(!r){e.next=23;break}return e.next=23,this.killVillagers(r);case 23:if(i===o){e.next=26;break}return e.next=26,this.engine.dispatch(this.engine.actions.game.buildings.setM({hut:i}));case 26:return e.abrupt("return",{dead:r,destroyHut:i-o});case 27:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),a.killVillagers=function(){var e=o(p.mark((function e(t){var a,r,o,i,s,c,l,u;return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this.engine.getState(),(o=(r=a.game.population.value)- -1*t)<0&&(o=0),o===r){e.next=7;break}return e.next=7,this.engine.dispatch(this.engine.actions.game.population.setM({value:o}));case 7:if(i=this.getNumGatherers(),s={},!(i<0)){e.next=25;break}c=-i,e.t0=p.keys(a.game.workers);case 12:if((e.t1=e.t0()).done){e.next=24;break}if(!((u=n.get(a.game.workers,l=e.t1.value,0))<c)){e.next=20;break}c-=u,s[l]=0,e.next=22;break;case 20:return s[l]=u+-1*c,e.abrupt("break",24);case 22:e.next=12;break;case 24:n.isPlainObject(s)||this.engine.dispatch(this.engine.actions.game.workers.setM(s));case 25:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),a.getNumGatherers=function(){var e=this.engine.getState(),t=e.game.population.value;for(var a in e.game.workers)t-=n.get(e.game.workers,a,0);return t},a.getMaxPopulation=function(){return(this.engine.getState().game.buildings.hut||0)*X.Outside.HUT_ROOM},a.schedulePopIncrease=function(){var e=Math.floor(Math.random()*(X.Outside.POP_DELAY[1]-X.Outside.POP_DELAY[0]))+X.Outside.POP_DELAY[0];Mt("next population increase scheduled in "+e+" minutes"),this._popTimeout=this.engine.setTimeout(this.increasePopulation.bind(this),60*e*1e3)},a.increasePopulation=function(){var e=this.engine.getState();if(e.features.location.Outside){var t=this.getMaxPopulation()-e.game.population.value;if(t>0){var n=Math.floor(Math.random()*(t/2)+t/2);0===n&&(n=1),this.engine.notify(1==n?"a stranger arrives in the night":n<5?"a weathered family takes up in one of the huts.":n<10?"a small group arrives, all dust and bones.":n<30?"a convoy lurches in, equal parts worry and hope.":"the town's booming. word does get around."),Mt("population increased by "+n),this.engine.dispatch(this.engine.actions.game.population.addM({value:n}))}}this.schedulePopIncrease()},a.enableBuildingWorker=function(){var e=this.engine.getState(),t={lodge:["hunter","trapper"],tannery:["tanner"],smokehouse:["charcutier"],"iron mine":["iron miner"],"coal mine":["coal miner"],"sulphur mine":["sulphur miner"],steelworks:["steelworker"],armoury:["armourer"]},n=!1;for(var a in e.game.buildings)if("trap"!==a){var r=t[a];if(r)for(var o=0,i=r.length;o<i;o++){var s,c=r[o];void 0!==e.game.buildings[a]&&void 0===e.game.workers[c]&&(this.engine.dispatch(this.engine.actions.game.workers.setM(((s={})[c]=0,s))),n=!0)}}return n},a.updateVillageIncome=function(){var e=this.engine.getState();for(var t in X.Outside.INCOME){var n=X.Outside.INCOME[t],a="gatherer"==t?this.getNumGatherers():e.game.workers[t]||0;if("number"==typeof a){var r={};a<0&&(a=0);var o=!1,i=this.engine.getIncome(t);for(var s in n.stores)r[s]=(n.stores[s]||0)*a,i[s]!==r[s]&&(o=!0);o&&this.engine.setIncome(t,{delay:n.delay,stores:r})}}},t}(Xt),pn=function(e){function t(t){return e.call(this,t)||this}s(t,e);var n=t.prototype;return n.collectStores=function(){var e,t,n,a=(null==(e=this.engine.store)?void 0:e.getState()).previous.stores;if(a&&a.length>0){var r,o,i={};for(var s in X.Prestige.storesMap)i[X.Prestige.storesMap[s].store.toString()]=a[s];null==(r=this.engine)||null==(o=r.store)||o.dispatch(this.engine.actions.stores.addM(i))}null==(t=this.engine)||null==(n=t.store)||n.dispatch(this.engine.actions.previous.setM({stores:[]}))},n.save=function(){var e,t=this.getStores(!0),n=this.totalScore();null==(e=this.engine.store)||e.dispatch(this.engine.actions.previous.setM({stores:t,score:n}))},n.totalScore=function(){var e,t=null==(e=this.engine.store)?void 0:e.getState();return((null==t?void 0:t.previous.score)||0)+this.calculateScore()},n.calculateScore=function(){for(var e,t=null==(e=this.engine.store)?void 0:e.getState(),n=this.getStores(!1),a=0,r=[1,1.5,1,2,2,3,3,2,2,2,2,1.5,1,1,10,30,50,100,150,150,3,3,5,4],o=0;o<r.length;o++)a+=n[o]*r[o];return a+=10*((null==t?void 0:t.stores.alien_alloy)||0),a+=50*t.game.spaceShip.hull,Math.floor(a)},n.getStores=function(e){var t=this.engine.store.getState(),n=[];for(var a in X.Prestige.storesMap){var r=X.Prestige.storesMap[a];n.push(Math.floor((t.stores[r.store]||0)/(e?this.randGen(r.type):1)))}return n},n.randGen=function(e){var t;switch(e){case"g":t=Math.floor(10*Math.random());break;case"w":t=Math.floor(Math.floor(10*Math.random())/2);break;case"a":t=Math.ceil(10*Math.random()*Math.ceil(10*Math.random()));break;default:return 1}return 0!==t?t:1},t}(Xt);Zt.add({id:"Engine.travelTo",name:"travel to",isAvailable:function(e){var t=e.getState(),n=0;return Object.keys(t.features.location).forEach((function(e){t.features.location[e]&&n++})),!t.engine.activeSubSpace&&n>1&&t.engine.activeSpace!==exports.GameSpace.World&&t.engine.activeSpace!==exports.GameSpace.Space},exec:function(){var e=o(p.mark((function e(t,n,a){return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.travelTo(a);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}(),help:function(e){var t=e.getState(),n=[];return Object.keys(t.features.location).forEach((function(e){t.features.location[e]&&n.push(e)})),{desc:"travel to "+n.join(", "),parms:[n]}}}),Zt.add({id:"Engine.SubSpace.back",name:"Back",isAvailable:function(e){return!!e.getState().engine.activeSubSpace},meta:{},exec:function(){var e=o(p.mark((function e(t){return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.travelToSubSpace("");case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()});var gn=function(){function e(e){this.GAME_OVER=!1,this.options={debug:!1,doubleTime:!1},this.actions=Lt,this.paused=!1,this._incomeTimeout=null,Object.assign(this.options,e||{}),function(e){Wt=e.enable||!1}({enable:this.options.debug}),this.operationExecutor=new Jt(this,Zt),this.startGame(null==e?void 0:e.state)}var a=e.prototype;return a.notify=function(e,t,n){var a;null==(a=this.store)||a.dispatch(this.actions.notifications.notify({message:{text:e,module:t},noQueue:n}))},a.dispatch=function(){var e=o(p.mark((function e(t){return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.store.dispatch(t);case 2:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),a.operation=function(){var e=o(p.mark((function e(t,n){return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.operationExecutor.exec(t,n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),a.operations=function(){return this.operationExecutor.availableOperations()},a.startGame=function(e){var t;this.GAME_OVER=!1,this.paused=!1,this.loadGame(e),this.events=new en(this),this.spaces=((t={})[exports.GameSpace.World]=new an(this),t[exports.GameSpace.Room]=new on(this),t[exports.GameSpace.Outside]=new mn(this),t[exports.GameSpace.Path]=new ln(this),t[exports.GameSpace.Ship]=new dn(this),t[exports.GameSpace.Space]=new hn(this),t),this.prestige=new pn(this),this._incomeTimeout=this.setTimeout(this.collectIncome.bind(this),1e3);var n=this.getState();this.travelTo(null!=n&&n.engine.activeSpace?null==n?void 0:n.engine.activeSpace:exports.GameSpace.Room,!0)},a.clean=function(){var e=this;this.events&&(clearTimeout(this._incomeTimeout),this.events.clean(),Object.keys(this.spaces).forEach((function(t){e.spaces[t].clean()})),this.prestige.clean())},a.endGame=function(){this.GAME_OVER||(this.GAME_OVER=!0,this.clean())},a.addToStore=function(e){this.dispatch(this.actions.stores.addM(e))},a.setToStore=function(e){this.dispatch(this.actions.stores.setM(e))},a.observer=function(e,t){var a,r=this.store;function o(){var o=e(r.getState());n.isEqual(o,a)||t(a=o)}var i=r.subscribe(o);return o(),i},a.getIncome=function(e){var t=this.getState();return n.get(t.income,e,{})},a.setIncome=function(e,t){var a,r=this.getState(),o=n.get(r.income,e);o&&(t.timeLeft=o.timeLeft),this.dispatch(this.actions.income.setM(((a={})[e]=t,a)))},a.pauseGame=function(){this.paused=!0,this.clean()},a.continueGame=function(){var e;this.paused=!1,this.startGame(null==(e=this.store)?void 0:e.getState())},a.saveGame=function(){},a.getActionSpace=function(){var e;return null==(e=this.store)?void 0:e.getState().engine.activeSpace},a.getState=function(){return this.store.getState()},a.switchLanguage=function(){},a.travelTo=function(){var e=o(p.mark((function e(t,n){var a;return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.getActionSpace()===t&&!n){e.next=7;break}return e.next=4,this.travelToSubSpace("");case 4:return e.next=6,null==(a=this.store)?void 0:a.dispatch(this.actions.engine.changeSpace(t));case 6:this.spaces[t].onArrival();case 7:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),a.travelToSubSpace=function(){var e=o(p.mark((function e(t){var n;return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null==(n=this.store)?void 0:n.dispatch(this.actions.engine.changeSubSpace(t));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),a.getGuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))},a.setTimeout=function(e){function t(t,n,a){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e,t,n){return this.options.doubleTime&&!n&&(Mt("Double time, cutting timeout in half"),t/=2),setTimeout(e,t)})),a.setInterval=function(e){function t(t,n,a){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e,t,n){return this.options.doubleTime&&!n&&(Mt("Double time, cutting timeout in half"),t/=2),setInterval(e,t)})),a.loadGame=function(e){this.store=function(e,n){return t.configureStore({reducer:_t,preloadedState:n,middleware:function(t){return t({thunk:{extraArgument:{engine:e}}}).concat(At)}})}(this,e)},a.collectIncome=function(){var e=!1,t=[],a=n.cloneDeep(this.getState());if(a.engine.activeSpace!==exports.GameSpace.Space)for(var r in a.income){var o=a.income[r];if(o&&("number"!=typeof o.timeLeft&&(o.timeLeft=0),o.timeLeft--,o.timeLeft<=0)){Mt("collection income from "+r),"thieves"===r&&this.addStolen(o.stores);var i=o.stores,s=!0;if("thieves"!==r)for(var c in i)if((a.stores[c]||0)+i[c]<0){s=!1;break}s&&t.push(o.stores),e=!0,"number"==typeof o.delay&&(o.timeLeft=o.delay)}}if(e){var l={};t.forEach((function(e){Object.keys(e).forEach((function(t){(l[t]||0+e[t])&&(l[t]=l[t]||0+e[t]||0)}))})),this.dispatch(this.actions.stores.addM(l))}this.dispatch(this.actions.income.setM(a.income)),this._incomeTimeout=this.setTimeout(this.collectIncome.bind(this),1e3)},a.addStolen=function(e){var t=this.getState(),n={};for(var a in e){var r=(t.stores[a]||0)+e[a];n[a]=r<0?-1*e[a]+r:-1*e[a]}this.dispatch(this.actions.game.stolen.addM(n))},e}();n.templateSettings.interpolate=/{([\s\S]+?)}/;var fn=new a,vn=[],xn={},bn=/\\{\w+\\}/g;function yn(e,t){if(xn[e])return xn[e];if(!isNaN(Number(e)))return e;if(X.items[e])e=X.items[e].name;else if(X.Outside.INCOME[e])e=X.Outside.INCOME[e].name;else for(var n=0,a=vn.length;n<a;n++){var r=vn[n],o=r.match.exec(e);if(r.match.lastIndex=0,o){var i=r.interpolcation(r.template,r.keys,o.slice(1));return xn[e]=i,i}}var s=fn.t(e,t);return xn[e]=s,s}exports.Engine=gn,exports.Perks=y,exports.config=X,exports.incomes=P,exports.setTranslation=function(e){(fn=new a).extend(e),vn=[],xn={},Object.keys(e).forEach((function(t){for(var n=/{(.+?)}/g,a=n.exec(t),r=[];a;)r.push(a[1]),a=n.exec(t);if(r.length>0){var o=function(e){if("string"!=typeof e)throw new TypeError("Expected a string");return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}(t).replace(bn,"(.+?)");vn.push({match:new RegExp("^"+o+"$"),interpolcation:function(e,t,n){var a={};return t.forEach((function(e,t){a[e]=yn(n[t])})),e.replace(/{(.+?)}/g,(function(e,t){return void 0===a[t]?t:a[t]}))},template:e[t],keys:r})}})),vn.sort((function(e,t){return t.template.length-e.template.length}))},exports.translate=yn;
//# sourceMappingURL=adarkroom-core.cjs.production.min.js.map
